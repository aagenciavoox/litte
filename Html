<!doctype html>
<html lang="pt-BR">
     <head>
          <meta charset="UTF-8" />
          <meta name="viewport" content="width=device-width,initial-scale=1.0" />
          <title>Sistema Litt√™ v3.5</title>
          <script src="https://cdn.tailwindcss.com"></script>
          <script src="https://unpkg.com/lucide@latest"></script>
          <script>
               tailwind.config = {
                    theme: {
                         extend: {
                              colors: {
                                   "litte-dark": "#0F172A",
                                   "litte-green": "#10B981",
                                   "litte-cream": "#FEF3C7",
                                   "litte-orange": "#F59E0B",
                                   "litte-accent": "#6366F1",
                              },
                         },
                    },
               };
          </script>
          <style>
               * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
               }
               body {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
                         sans-serif;
                    overflow-x: hidden;
                    background: #f8fafc;
               }
               ::-webkit-scrollbar {
                    width: 8px;
                    height: 8px;
               }
               ::-webkit-scrollbar-track {
                    background: #f1f5f9;
               }
               ::-webkit-scrollbar-thumb {
                    background: #10b981;
                    border-radius: 4px;
               }
               ::-webkit-scrollbar-thumb:hover {
                    background: #059669;
               }
               .fade-in {
                    animation: fadeIn 0.3s ease-in;
               }
               @keyframes fadeIn {
                    from {
                         opacity: 0;
                    }
                    to {
                         opacity: 1;
                    }
               }
               .modal-backdrop {
                    background-color: rgba(15, 23, 42, 0.7);
                    backdrop-filter: blur(4px);
               }
               .spinner {
                    border: 3px solid #fef3c7;
                    border-top: 3px solid #10b981;
                    border-radius: 50%;
                    width: 24px;
                    height: 24px;
                    animation: spin 1s linear infinite;
               }
               @keyframes spin {
                    0% {
                         transform: rotate(0deg);
                    }
                    100% {
                         transform: rotate(360deg);
                    }
               }
               .sidebar-item {
                    transition: all 0.2s ease;
                    border-radius: 12px;
                    margin: 4px 8px;
               }
               .sidebar-item:hover {
                    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
                    transform: translateX(4px);
               }
               .sidebar-item.active {
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: #fff;
                    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
               }
               .card-metric {
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
               }
               .card-metric:hover {
                    transform: translateY(-4px);
                    box-shadow:
                         0 20px 25px -5px rgba(0, 0, 0, 0.1),
                         0 10px 10px -5px rgba(0, 0, 0, 0.04);
               }
               .btn-primary {
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: #fff;
                    transition: all 0.2s;
                    box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3);
               }
               .btn-primary:hover {
                    background: linear-gradient(135deg, #059669 0%, #047857 100%);
                    box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.4);
               }
               .btn-secondary {
                    background: #fff;
                    color: #334155;
                    border: 2px solid #e2e8f0;
                    transition: all 0.2s;
               }
               .btn-secondary:hover {
                    background: #f8fafc;
                    border-color: #10b981;
               }
               .badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 4px;
                    padding: 4px 12px;
                    border-radius: 12px;
                    font-size: 12px;
                    font-weight: 600;
               }
               .badge-success {
                    background: #d1fae5;
                    color: #065f46;
               }
               .badge-warning {
                    background: #fef3c7;
                    color: #92400e;
               }
               .badge-danger {
                    background: #fee2e2;
                    color: #991b1b;
               }
               .badge-info {
                    background: #dbeafe;
                    color: #1e40af;
               }
               .toast-container {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 9999;
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                    max-width: 400px;
               }
               .toast {
                    background: #fff;
                    border-radius: 16px;
                    padding: 16px 20px;
                    box-shadow:
                         0 20px 25px -5px rgba(0, 0, 0, 0.1),
                         0 10px 10px -5px rgba(0, 0, 0, 0.04);
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
               }
               @keyframes slideInRight {
                    from {
                         transform: translateX(400px);
                         opacity: 0;
                    }
                    to {
                         transform: translateX(0);
                         opacity: 1;
                    }
               }
               .toast-success {
                    border-left: 4px solid #10b981;
               }
               .toast-error {
                    border-left: 4px solid #ef4444;
               }
               .toast-info {
                    border-left: 4px solid #6366f1;
               }
               .skeleton {
                    background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
                    background-size: 200% 100%;
                    animation: shimmer 1.5s infinite;
               }
               @keyframes shimmer {
                    0% {
                         background-position: 200% 0;
                    }
                    100% {
                         background-position: -200% 0;
                    }
               }
               table {
                    border-collapse: collapse;
                    width: 100%;
               }
               th {
                    position: sticky;
                    top: 0;
                    background: #0f172a;
                    z-index: 10;
               }
               .modal-enter {
                    animation: modalEnter 0.3s cubic-bezier(0.4, 0, 0.2, 1);
               }
               @keyframes modalEnter {
                    from {
                         transform: translateY(50px) scale(0.95);
                         opacity: 0;
                    }
                    to {
                         transform: translateY(0) scale(1);
                         opacity: 1;
                    }
               }
               .accordion-item {
                    transition: all 0.2s ease;
               }
               .accordion-item:hover {
                    background: #f8fafc;
               }
          </style>
     </head>
     <body class="bg-slate-50">
          <div class="flex h-screen">
               <aside id="sidebar" class="w-64 bg-litte-dark text-white flex flex-col shadow-2xl">
                    <div class="p-6 border-b border-slate-700">
                         <h1
                              class="text-2xl font-bold bg-gradient-to-r from-litte-green to-litte-accent bg-clip-text text-transparent"
                         >
                              Sistema Litt√™
                         </h1>
                         <p class="text-sm text-slate-400 mt-1">v3.5 Premium</p>
                    </div>
                    <nav class="flex-1 overflow-y-auto py-4">
                         <a
                              href="#"
                              class="sidebar-item active flex items-center px-4 py-3 text-white"
                              onclick="loadView('dashboard')"
                              ><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i><span>Dashboard</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('assessorados')"
                              ><i data-lucide="users" class="w-5 h-5 mr-3"></i><span>Assessorados</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('prospeccoes')"
                              ><i data-lucide="target" class="w-5 h-5 mr-3"></i><span>Prospec√ß√µes</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('campanhas')"
                              ><i data-lucide="rocket" class="w-5 h-5 mr-3"></i><span>Campanhas Ativas</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('financeiro')"
                              ><i data-lucide="dollar-sign" class="w-5 h-5 mr-3"></i><span>Financeiro</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('templates')"
                              ><i data-lucide="file-text" class="w-5 h-5 mr-3"></i><span>Templates</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('notas')"
                              ><i data-lucide="sticky-note" class="w-5 h-5 mr-3"></i><span>Notas</span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('notificacoes')"
                              ><i data-lucide="bell" class="w-5 h-5 mr-3"></i><span>Notifica√ß√µes</span
                              ><span
                                   id="notif-badge"
                                   class="ml-auto bg-litte-orange text-white text-xs rounded-full px-2 py-1 hidden"
                              ></span></a
                         ><a
                              href="#"
                              class="sidebar-item flex items-center px-4 py-3 text-slate-300"
                              onclick="loadView('config')"
                              ><i data-lucide="settings" class="w-5 h-5 mr-3"></i><span>Configura√ß√µes</span></a
                         >
                    </nav>
                    <div class="p-4 border-t border-slate-700 text-sm text-slate-400">
                         <div class="flex items-center gap-2">
                              <i data-lucide="clock" class="w-4 h-4"></i><span>√öltima sync:</span>
                         </div>
                         <span id="last-sync" class="text-slate-500 text-xs">--</span>
                    </div>
               </aside>
               <main class="flex-1 overflow-hidden flex flex-col">
                    <header id="view-header" class="bg-white shadow-sm border-b border-slate-200 px-6 py-4">
                         <div class="flex items-center justify-between">
                              <div>
                                   <h2 id="view-title" class="text-2xl font-bold text-slate-900">Dashboard</h2>
                                   <p id="view-subtitle" class="text-sm text-slate-600 mt-1">Vis√£o geral do sistema</p>
                              </div>
                              <div id="view-actions" class="flex gap-2"></div>
                         </div>
                    </header>
                    <div id="view-content" class="flex-1 overflow-y-auto p-6 bg-slate-50"></div>
               </main>
          </div>
          <div id="modals-container"></div>
          <div
               id="loading-overlay"
               class="hidden fixed inset-0 bg-slate-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50"
          >
               <div class="bg-white rounded-3xl p-8 flex flex-col items-center gap-4 shadow-2xl">
                    <div class="spinner"></div>
                    <span id="loading-text" class="text-slate-700 font-medium">Carregando...</span>
               </div>
          </div>
          <div id="toast-container" class="toast-container"></div>
          <script>
               let currentView = "dashboard";
               let cachedData = {
                    assessorados: null,
                    prospeccoes: null,
                    campanhas: null,
                    financeiro: null,
                    notificacoes: null,
                    templates: null,
                    notas: null,
               };
               function showLoading(text = "Carregando...") {
                    document.getElementById("loading-text").textContent = text;
                    document.getElementById("loading-overlay").classList.remove("hidden");
               }
               function hideLoading() {
                    document.getElementById("loading-overlay").classList.add("hidden");
               }
               function showToast(message, type = "success") {
                    const container = document.getElementById("toast-container");
                    const toast = document.createElement("div");
                    const icons = { success: "check-circle", error: "x-circle", info: "info" };
                    toast.className = `toast toast-${type}`;
                    toast.innerHTML = `<i data-lucide="${icons[type]}" class="w-5 h-5 ${type === "success" ? "text-litte-green" : type === "error" ? "text-red-500" : "text-litte-accent"}"></i><div class="flex-1"><p class="font-semibold text-slate-900 text-sm">${message}</p></div><button onclick="this.parentElement.remove()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x" class="w-4 h-4"></i></button>`;
                    container.appendChild(toast);
                    lucide.createIcons();
                    setTimeout(() => toast.remove(), 3000);
               }
               function formatCurrency(value) {
                    return new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }).format(value || 0);
               }
               function formatDate(dateString) {
                    if (!dateString) return "--";
                    const date = new Date(dateString);
                    return date.toLocaleDateString("pt-BR");
               }
               function formatDateTime(dateString) {
                    if (!dateString) return "--";
                    const date = new Date(dateString);
                    return (
                         date.toLocaleDateString("pt-BR") +
                         " " +
                         date.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" })
                    );
               }
               function formatDataSimples(data) {
                    if (!data) return "";
                    const d = new Date(data);
                    return d.toLocaleDateString("pt-BR", { day: "2-digit", month: "short" });
               }
               function updateLastSync() {
                    const now = new Date();
                    document.getElementById("last-sync").textContent = now.toLocaleTimeString("pt-BR");
               }
               function closeModal(modalId) {
                    const modal = document.getElementById(modalId);
                    if (modal) modal.remove();
               }
               function loadView(viewName) {
                    currentView = viewName;
                    document.querySelectorAll(".sidebar-item").forEach((item) => item.classList.remove("active"));
                    event.target.closest(".sidebar-item").classList.add("active");
                    switch (viewName) {
                         case "dashboard":
                              renderDashboard();
                              break;
                         case "assessorados":
                              renderAssessorados();
                              break;
                         case "prospeccoes":
                              renderProspeccoes();
                              break;
                         case "campanhas":
                              renderCampanhas();
                              break;
                         case "financeiro":
                              renderFinanceiro();
                              break;
                         case "templates":
                              renderTemplates();
                              break;
                         case "notas":
                              renderNotas();
                              break;
                         case "notificacoes":
                              renderNotificacoes();
                              break;
                         case "config":
                              renderConfig();
                              break;
                    }
               }
               function renderDashboard() {
                    const viewTitle = document.getElementById("view-title");
                    const viewSubtitle = document.getElementById("view-subtitle");
                    const viewActions = document.getElementById("view-actions");
                    if (viewTitle) viewTitle.textContent = "Dashboard";
                    if (viewSubtitle) viewSubtitle.textContent = "Vis√£o geral do sistema e indicadores";
                    if (viewActions) {
                         viewActions.innerHTML = `<button onclick="openModalNovoAndamento()" class="btn-primary px-4 py-2 rounded-xl flex items-center gap-2 font-medium shadow-lg"><i data-lucide="plus" class="w-4 h-4"></i><span>Novo Andamento</span></button><button onclick="refreshDashboard()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                         lucide.createIcons();
                    }
                    showLoading("Sincronizando indicadores...");
                    google.script.run
                         .withSuccessHandler(function (response) {
                              if (response && response.success) {
                                   renderDashboardCards(response);
                                   carregarUltimasAtividades();
                                   carregarProximosPrazos();
                                   updateLastSync();
                              } else {
                                   showToast("Erro nos dados do servidor", "error");
                              }
                              hideLoading();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Falha na conex√£o", "error");
                              console.error("Dashboard Error:", error);
                         })
                         .getDashboardData();
               }
               function renderDashboardCards(data) {
                    const html = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div class="card-metric bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-xl"><div class="flex justify-between items-start mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase tracking-wider text-slate-500 mb-2">Total Assessorados</p><h3 class="text-4xl font-black text-slate-900">${data.totalAssessorados || 0}</h3></div><div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg"><i data-lucide="users" class="w-7 h-7 text-white"></i></div></div><div class="pt-3 border-t border-slate-100"><p class="text-xs text-slate-500 italic">Base ativa no sistema</p></div></div><div class="card-metric bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-xl"><div class="flex justify-between items-start mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase tracking-wider text-slate-500 mb-2">Campanhas Ativas</p><h3 class="text-4xl font-black text-slate-900">${data.campanhasAtivas || 0}</h3></div><div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-lg"><i data-lucide="rocket" class="w-7 h-7 text-white"></i></div></div><div class="pt-3 border-t border-slate-100"><p class="text-xs text-slate-500 italic">Em fase de execu√ß√£o</p></div></div><div class="card-metric bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-xl"><div class="flex justify-between items-start mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase tracking-wider text-slate-500 mb-2">Faturamento M√™s</p><h3 class="text-3xl font-black text-slate-900">${formatCurrency(data.faturamentoMes || 0)}</h3></div><div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center shadow-lg"><i data-lucide="trending-up" class="w-7 h-7 text-white"></i></div></div><div class="pt-3 border-t border-slate-100"><p class="text-xs text-slate-500 italic">Valores recebidos</p></div></div><div class="card-metric bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-xl"><div class="flex justify-between items-start mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase tracking-wider text-slate-500 mb-2">Taxa Convers√£o</p><h3 class="text-4xl font-black text-slate-900">${data.taxaConversao || 0}%</h3></div><div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center shadow-lg"><i data-lucide="target" class="w-7 h-7 text-white"></i></div></div><div class="pt-3 border-t border-slate-100"><p class="text-xs text-slate-500 italic">Prospec√ß√µes vs Fechamentos</p></div></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><div class="bg-white border-l-4 border-yellow-400 p-5 rounded-2xl shadow-sm hover:shadow-lg transition-all flex items-center gap-4"><div class="w-12 h-12 bg-yellow-50 rounded-xl flex items-center justify-center"><i data-lucide="target" class="w-6 h-6 text-yellow-600"></i></div><div><p class="text-slate-500 text-xs font-bold uppercase tracking-wider">Em Negocia√ß√£o</p><p class="text-3xl font-black text-slate-900">${data.prospeccoes || 0}</p></div></div><div class="bg-white border-l-4 border-red-500 p-5 rounded-2xl shadow-sm hover:shadow-lg transition-all flex items-center gap-4"><div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center"><i data-lucide="alert-circle" class="w-6 h-6 text-red-600"></i></div><div><p class="text-slate-500 text-xs font-bold uppercase tracking-wider">Prazos Vencidos</p><p class="text-3xl font-black text-red-600">${data.pendencias || 0}</p></div></div><div class="bg-white border-l-4 border-indigo-500 p-5 rounded-2xl shadow-sm hover:shadow-lg transition-all flex items-center gap-4"><div class="w-12 h-12 bg-indigo-50 rounded-xl flex items-center justify-center"><i data-lucide="file-text" class="w-6 h-6 text-indigo-600"></i></div><div><p class="text-slate-500 text-xs font-bold uppercase tracking-wider">NFs a Emitir</p><p class="text-3xl font-black text-indigo-700">${data.nfsPendentes || 0}</p></div></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-white rounded-3xl shadow-sm border border-slate-200 flex flex-col h-[500px]"><div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-3xl"><h3 class="font-bold text-slate-700 flex items-center gap-2"><i data-lucide="activity" class="w-5 h-5"></i>√öltimas Atividades</h3></div><div id="ultimas-atividades" class="flex-1 overflow-y-auto p-4 space-y-1"><div class="flex flex-col items-center justify-center h-full text-slate-400"><div class="skeleton w-8 h-8 rounded-full mb-2"></div><p class="text-xs">Buscando logs...</p></div></div></div><div class="bg-white rounded-3xl shadow-sm border border-slate-200 flex flex-col h-[500px]"><div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-3xl"><h3 class="font-bold text-slate-700 flex items-center gap-2"><i data-lucide="clock" class="w-5 h-5"></i>Pr√≥ximos Prazos</h3></div><div id="proximos-prazos" class="flex-1 overflow-y-auto p-4 space-y-1"><div class="flex flex-col items-center justify-center h-full text-slate-400"><div class="skeleton w-8 h-8 rounded-full mb-2"></div><p class="text-xs">Mapeando entregas...</p></div></div></div></div>`;
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function carregarUltimasAtividades() {
                    google.script.run
                         .withSuccessHandler(renderUltimasAtividades)
                         .withFailureHandler(function () {
                              document.getElementById("ultimas-atividades").innerHTML =
                                   `<p class="p-4 text-red-500 text-center text-sm">Erro ao carregar log.</p>`;
                         })
                         .getUltimasAtividades(15);
               }
               function renderUltimasAtividades(atividades) {
                    const container = document.getElementById("ultimas-atividades");
                    if (!atividades || atividades.length === 0) {
                         container.innerHTML = `<div class="text-center py-10 text-slate-400 text-sm">Sem atividades recentes.</div>`;
                         return;
                    }
                    container.innerHTML = atividades
                         .map((ativ) => {
                              const icone = getIconeAtividade(ativ.tipo);
                              return `<div class="group flex items-start gap-3 p-3 rounded-xl hover:bg-slate-50 transition-all border-b border-slate-50 last:border-0"><div class="w-10 h-10 rounded-xl bg-gradient-to-br ${getCorAtividade(ativ.tipo)} flex items-center justify-center flex-shrink-0 shadow-sm group-hover:scale-110 transition-transform"><i data-lucide="${icone}" class="w-5 h-5 text-white"></i></div><div class="flex-1 min-w-0"><div class="flex justify-between items-start mb-1"><p class="text-sm font-bold text-slate-800 truncate">${ativ.acao}</p><span class="text-xs text-slate-400 whitespace-nowrap ml-2">${formatDateTime(ativ.dataHora)}</span></div><p class="text-xs text-slate-500 flex items-center gap-1"><span class="font-semibold px-1 rounded bg-slate-100 text-xs">${ativ.tipo}</span>${ativ.idCampanha ? '‚Ä¢ <span class="truncate">' + ativ.idCampanha + "</span>" : ""}</p><p class="text-xs text-slate-400 italic">Por: ${ativ.usuario || "Sistema"}</p></div></div>`;
                         })
                         .join("");
                    lucide.createIcons();
               }
               function carregarProximosPrazos() {
                    google.script.run
                         .withSuccessHandler(renderProximosPrazos)
                         .withFailureHandler(function () {
                              document.getElementById("proximos-prazos").innerHTML =
                                   `<p class="p-4 text-red-500 text-center text-sm">Erro ao carregar prazos.</p>`;
                         })
                         .getProximosPrazos(15);

                    // Complemento: carregar prazos filtrados do checklist
                    google.script.run
                         .withSuccessHandler(renderPrazosChecklistFiltrados)
                         .withFailureHandler(function () {
                              // Silencioso - n√£o mostra erro, apenas n√£o complementa
                         })
                         .getProximosPrazosChecklist();
               }
               function renderProximosPrazos(prazos) {
                    const container = document.getElementById("proximos-prazos");
                    if (!prazos || prazos.length === 0) {
                         container.innerHTML = `<div class="text-center py-10 text-slate-400 text-sm">Nenhuma entrega pendente! üéâ</div>`;
                         return;
                    }
                    container.innerHTML = prazos
                         .map((prazo) => {
                              const status = getStatusPrazo(prazo.diasRestantes);
                              return `<div class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-all border-l-4 ${status.border} mb-2 bg-white shadow-sm border-y border-r border-slate-100"><div class="flex-1 min-w-0 pl-1"><div class="flex items-center gap-2 mb-1"><span class="px-2 py-0.5 rounded-full text-xs font-black uppercase ${status.badge}">${status.label}</span><span class="text-xs font-bold text-slate-600">${formatDataSimples(prazo.dataPrevista)}</span></div><p class="text-sm font-bold text-slate-800 truncate">${prazo.etapa}</p><p class="text-xs text-slate-500 truncate">${prazo.idCampanha}${prazo.marca ? " | " + prazo.marca : ""}</p></div><button onclick="abrirDetalhesCampanha('${prazo.idCampanha}')" class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-slate-200 text-slate-400 hover:text-litte-accent transition-all"><i data-lucide="eye" class="w-4 h-4"></i></button></div>`;
                         })
                         .join("");
                    lucide.createIcons();
               }
               function getStatusPrazo(dias) {
                    if (dias < 0)
                         return { label: "Atrasado", border: "border-red-500", badge: "bg-red-100 text-red-700" };
                    if (dias === 0)
                         return { label: "Hoje", border: "border-orange-500", badge: "bg-orange-100 text-orange-700" };
                    if (dias === 1)
                         return {
                              label: "Amanh√£",
                              border: "border-yellow-500",
                              badge: "bg-yellow-100 text-yellow-700",
                         };
                    if (dias <= 3)
                         return {
                              label: `Em ${dias} dias`,
                              border: "border-blue-400",
                              badge: "bg-blue-50 text-blue-600",
                         };
                    return {
                         label: `Em ${dias} dias`,
                         border: "border-slate-300",
                         badge: "bg-slate-100 text-slate-600",
                    };
               }
               function getIconeAtividade(tipo) {
                    const icones = {
                         Assessorado: "user",
                         Andamento: "edit",
                         Campanha: "video",
                         Checklist: "check-square",
                         Financeiro: "dollar-sign",
                         Status: "bar-chart",
                         Drive: "folder",
                         Automa√ß√£o: "zap",
                         Nota: "sticky-note",
                    };
                    return icones[tipo] || "info";
               }
               function getCorAtividade(tipo) {
                    const cores = {
                         Assessorado: "from-blue-500 to-blue-600",
                         Andamento: "from-purple-500 to-purple-600",
                         Campanha: "from-emerald-500 to-emerald-600",
                         Checklist: "from-yellow-500 to-yellow-600",
                         Financeiro: "from-green-500 to-green-600",
                         Status: "from-indigo-500 to-indigo-600",
                         Drive: "from-orange-500 to-orange-600",
                         Automa√ß√£o: "from-pink-500 to-pink-600",
                    };
                    return cores[tipo] || "from-slate-500 to-slate-600";
               }
               function renderPrazosChecklistFiltrados(prazosChecklist) {
                    const container = document.getElementById("proximos-prazos");
                    if (!prazosChecklist || prazosChecklist.length === 0) {
                         return; // Mant√©m o conte√∫do existente se n√£o houver prazos do checklist
                    }

                    // Complementar os prazos existentes com os do checklist
                    const html = prazosChecklist
                         .map((prazo) => {
                              const status = getStatusPrazoChecklist(prazo.diasRestantes);
                              return `<div class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-all border-l-4 ${status.border} mb-2 bg-white shadow-sm border-y border-r border-slate-100"><div class="flex-1 min-w-0 pl-1"><div class="flex items-center gap-2 mb-1"><span class="px-2 py-0.5 rounded-full text-xs font-black uppercase ${status.badge}">${status.label}</span><span class="text-xs font-bold text-slate-600">${formatDataSimples(prazo.dataPrevista)}</span></div><p class="text-sm font-bold text-slate-800 truncate">${prazo.tarefa}</p><p class="text-xs text-slate-500 truncate">${prazo.idCampanha}${prazo.marca ? " | " + prazo.marca : ""}${prazo.nomeAssessorado ? " | " + prazo.nomeAssessorado : ""}</p><p class="text-xs text-slate-400 italic">Status: ${prazo.status}</p></div><button onclick="openModalChecklist('${prazo.idCampanha}')" class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-slate-200 text-slate-400 hover:text-litte-accent transition-all" title="Abrir Checklist"><i data-lucide="check-square" class="w-4 h-4"></i></button></div>`;
                         })
                         .join("");

                    // Adicionar os prazos do checklist ao container (substitui o conte√∫do)
                    container.innerHTML = html;
                    lucide.createIcons();
               }
               function getStatusPrazoChecklist(dias) {
                    if (dias < 0)
                         return { label: "ATRASADO", border: "border-red-500", badge: "bg-red-100 text-red-700" };
                    if (dias === 0)
                         return { label: "HOJE", border: "border-orange-500", badge: "bg-orange-100 text-orange-700" };
                    if (dias === 1)
                         return {
                              label: "AMANH√É",
                              border: "border-yellow-500",
                              badge: "bg-yellow-100 text-yellow-700",
                         };
                    if (dias <= 3)
                         return {
                              label: `${dias} DIAS`,
                              border: "border-blue-400",
                              badge: "bg-blue-50 text-blue-600",
                         };
                    return {
                         label: `${dias} DIAS`,
                         border: "border-slate-300",
                         badge: "bg-slate-100 text-slate-600",
                    };
               }
               function refreshDashboard() {
                    renderDashboard();
               }
               function abrirDetalhesCampanha(idCampanha) {
                    loadView("campanhas");
                    setTimeout(() => openModalChecklist(idCampanha), 500);
               }
               function renderAssessorados() {
                    document.getElementById("view-title").textContent = "Assessorados";
                    document.getElementById("view-subtitle").textContent = "Gerenciar influenciadores";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="openModalNovoAssessorado()" class="btn-primary px-4 py-2 rounded-xl flex items-center gap-2 font-medium shadow-lg"><i data-lucide="plus" class="w-4 h-4"></i><span>Novo Assessorado</span></button><button onclick="refreshAssessorados()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    document.getElementById("view-content").innerHTML =
                         `<div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-8 text-center"><div class="skeleton w-12 h-12 rounded-full mx-auto mb-4"></div><p class="text-slate-600">Carregando assessorados...</p></div>`;
                    google.script.run
                         .withSuccessHandler(function (assessorados) {
                              cachedData.assessorados = assessorados;
                              renderTabelaAssessorados(assessorados);
                              updateLastSync();
                         })
                         .withFailureHandler(function (error) {
                              document.getElementById("view-content").innerHTML =
                                   `<div class="bg-white rounded-3xl shadow-sm p-8 text-center"><p class="text-red-500 mb-4">Erro ao carregar assessorados</p><button onclick="refreshAssessorados()" class="btn-primary px-4 py-2 rounded-xl">Tentar novamente</button></div>`;
                              showToast("Erro ao carregar assessorados", "error");
                              console.error(error);
                         })
                         .getAllAssessorados();
               }
               function renderTabelaAssessorados(assessorados) {
                    const totalAtivos = assessorados.filter((a) => a.status === "Ativo").length;
                    const totalInativos = assessorados.length - totalAtivos;
                    let html = `<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"><div class="card-metric bg-white border-2 border-litte-dark rounded-2xl p-5 hover:shadow-xl transition-all"><div class="flex items-center justify-between"><div><p class="text-sm text-slate-600 mb-1 font-medium">Total</p><p class="text-4xl font-black text-litte-dark">${assessorados.length}</p></div><div class="w-12 h-12 bg-litte-dark rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="users" class="w-6 h-6 text-white"></i></div></div></div><div class="card-metric bg-white border-2 border-green-500 rounded-2xl p-5 hover:shadow-xl transition-all"><div class="flex items-center justify-between"><div><p class="text-sm text-slate-600 mb-1 font-medium">Ativos</p><p class="text-4xl font-black text-green-600">${totalAtivos}</p></div><div class="w-12 h-12 bg-green-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="check-circle" class="w-6 h-6 text-white"></i></div></div></div><div class="card-metric bg-white border-2 border-red-500 rounded-2xl p-5 hover:shadow-xl transition-all"><div class="flex items-center justify-between"><div><p class="text-sm text-slate-600 mb-1 font-medium">Inativos</p><p class="text-4xl font-black text-red-600">${totalInativos}</p></div><div class="w-12 h-12 bg-red-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="x-circle" class="w-6 h-6 text-white"></i></div></div></div><div class="card-metric bg-white border-2 border-litte-green rounded-2xl p-5 hover:shadow-xl transition-all"><div class="flex items-center justify-between"><div><p class="text-sm text-slate-600 mb-1 font-medium">Este M√™s</p><p class="text-4xl font-black text-litte-green">${getAssessoradosDoMes(assessorados)}</p></div><div class="w-12 h-12 bg-litte-green rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="calendar" class="w-6 h-6 text-white"></i></div></div></div></div><div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b border-slate-200"><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">ID</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Nome</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Usu√°rio</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Email</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Telefone</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Status</th><th class="text-center px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">A√ß√µes</th></tr></thead><tbody>`;
                    if (assessorados.length === 0) {
                         html += `<tr><td colspan="7" class="px-6 py-12 text-center text-slate-500"><div class="flex flex-col items-center gap-4"><i data-lucide="users" class="w-16 h-16 text-slate-300"></i><p class="text-lg font-medium">Nenhum assessorado cadastrado</p><button onclick="openModalNovoAssessorado()" class="btn-primary px-6 py-3 rounded-xl">Cadastrar Primeiro Assessorado</button></div></td></tr>`;
                    } else {
                         assessorados.forEach(function (a) {
                              html += `<tr class="border-b border-slate-100 hover:bg-slate-50 transition-all"><td class="px-6 py-4"><span class="font-mono font-bold text-xs text-litte-dark">${a.id || "--"}</span></td><td class="px-6 py-4"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-gradient-to-br from-litte-accent to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold shadow-sm">${a.nome ? a.nome.charAt(0).toUpperCase() : "?"}</div><span class="font-semibold text-slate-900">${a.nome || "--"}</span></div></td><td class="px-6 py-4"><span class="text-slate-600">@${a.usuario || "--"}</span></td><td class="px-6 py-4"><span class="text-sm text-slate-600">${a.email || "--"}</span></td><td class="px-6 py-4"><span class="text-sm text-slate-600">${a.telefone || "--"}</span></td><td class="px-6 py-4"><span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold ${a.status === "Ativo" ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"}"><i data-lucide="${a.status === "Ativo" ? "check" : "x"}" class="w-3 h-3"></i>${a.status || "Ativo"}</span></td><td class="px-6 py-4"><div class="flex items-center justify-center gap-1"><button onclick="verDetalhesAssessorado('${a.id}')" class="p-2 hover:bg-blue-50 rounded-xl transition-all" title="Ver detalhes"><i data-lucide="eye" class="w-4 h-4 text-slate-600"></i></button><button onclick="editarAssessorado('${a.id}')" class="p-2 hover:bg-yellow-50 rounded-xl transition-all" title="Editar"><i data-lucide="edit" class="w-4 h-4 text-slate-600"></i></button>${a.urlPastaDrive ? `<a href="${a.urlPastaDrive}" target="_blank" class="p-2 hover:bg-green-50 rounded-xl transition-all" title="Pasta Drive"><i data-lucide="folder" class="w-4 h-4 text-slate-600"></i></a>` : ""}${a.linkPlanilhaEspelho ? `<a href="${a.linkPlanilhaEspelho}" target="_blank" class="p-2 hover:bg-purple-50 rounded-xl transition-all" title="Planilha"><i data-lucide="table" class="w-4 h-4 text-slate-600"></i></a>` : ""}</div></td></tr>`;
                         });
                    }
                    html += `</tbody></table></div></div>`;
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function getAssessoradosDoMes(assessorados) {
                    const hoje = new Date();
                    const mesAtual = hoje.getMonth();
                    const anoAtual = hoje.getFullYear();
                    return assessorados.filter(function (a) {
                         if (!a.dataCadastro) return false;
                         const data = new Date(a.dataCadastro);
                         return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
                    }).length;
               }
               function refreshAssessorados() {
                    renderAssessorados();
               }
               function openModalNovoAssessorado() {
                    const assessoradosOptions = cachedData.assessorados
                         ? cachedData.assessorados
                                .map((a) => `<option value="${a.id}">${a.nome} (${a.usuario})</option>`)
                                .join("")
                         : "";
                    const modalHTML = `<div id="modal-novo-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="user-plus" class="w-5 h-5"></i>Novo Assessorado</h3><p class="text-sm text-slate-300 mt-1">Cadastre um novo influenciador</p></div><button onclick="closeModal('modal-novo-assessorado')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-novo-assessorado" onsubmit="salvarNovoAssessorado(event)"><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="user" class="w-5 h-5"></i>Informa√ß√µes B√°sicas</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome Completo *</label><input type="text" name="nome" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: Maria Silva"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Usu√°rio (Instagram/TikTok) *</label><div class="flex items-center"><span class="px-3 py-3 bg-slate-100 border border-r-0 border-slate-300 rounded-l-xl text-slate-600 font-semibold">@</span><input type="text" name="usuario" required class="flex-1 px-4 py-3 border border-slate-300 rounded-r-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="usuario_influencer"></div></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="mail" class="w-5 h-5"></i>Informa√ß√µes de Contato</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" name="email" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="email@exemplo.com"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Telefone</label><input type="tel" name="telefone" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="(00) 00000-0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Idade</label><input type="number" name="idade" min="1" max="120" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="25"></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="shirt" class="w-5 h-5"></i>Medidas e Tamanhos</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Camiseta</label><select name="camiseta" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all"><option value="">Selecione...</option><option value="PP">PP</option><option value="P">P</option><option value="M">M</option><option value="G">G</option><option value="GG">GG</option><option value="XG">XG</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Cal√ßa</label><input type="text" name="calca" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: 38, 40, 42"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Sapato</label><input type="text" name="sapato" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: 37, 38, 39"></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="map-pin" class="w-5 h-5"></i>Endere√ßo de Entrega</h4><div class="space-y-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome do Destinat√°rio</label><input type="text" name="enderecoNome" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: Maria Silva ou Nome da Empresa"></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="md:col-span-2"><label class="block text-sm font-semibold text-slate-700 mb-2">Rua/Avenida</label><input type="text" name="rua" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: Rua das Flores"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">N√∫mero</label><input type="text" name="numero" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="123"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Complemento</label><input type="text" name="complemento" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: Apto 101, Bloco B"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Bairro</label><input type="text" name="bairro" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: Centro"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Cidade</label><input type="text" name="cidade" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Ex: S√£o Paulo"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Estado</label><select name="estado" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all"><option value="">Selecione...</option><option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option><option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option><option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option><option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option><option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option><option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option><option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CEP</label><input type="text" name="cep" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="00000-000"></div></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="file-text" class="w-5 h-5"></i>Dados Pessoais</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" name="cpf" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="000.000.000-00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" name="rg" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="00.000.000-0"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" name="cnpj" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="00.000.000/0000-00"></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="users" class="w-5 h-5"></i>Testemunha</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome Completo</label><input type="text" name="testemunhaNome" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Nome da testemunha"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" name="testemunhaEmail" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="email@exemplo.com"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Telefone</label><input type="tel" name="testemunhaTelefone" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="(00) 00000-0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" name="testemunhaCpf" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="000.000.000-00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" name="testemunhaRg" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="00.000.000-0"></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="building" class="w-5 h-5"></i>Pessoa Jur√≠dica</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Raz√£o Social</label><input type="text" name="pjRazaoSocial" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Nome da empresa"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" name="pjCnpj" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="00.000.000/0000-00"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data de Cria√ß√£o</label><input type="date" name="pjDataCriacao" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" name="pjEmail" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="contato@empresa.com"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Endere√ßo</label><input type="text" name="pjEndereco" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Endere√ßo completo"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Municipal</label><input type="text" name="pjInscricaoMunicipal" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="N√∫mero da inscri√ß√£o"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Estadual</label><input type="text" name="pjInscricaoEstadual" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="N√∫mero da inscri√ß√£o"></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="credit-card" class="w-5 h-5"></i>Conta Banc√°ria</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Conta</label><select name="bancoTipo" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all"><option value="">Selecione...</option><option value="PF">Pessoa F√≠sica</option><option value="PJ">Pessoa Jur√≠dica</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Banco</label><input type="text" name="bancoNome" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Nome do banco"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Ag√™ncia</label><input type="text" name="bancoAgencia" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Conta</label><input type="text" name="bancoConta" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="00000-0"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">PIX</label><input type="text" name="bancoPix" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Chave PIX"></div></div></div><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes</label><textarea name="observacoes" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green focus:border-transparent transition-all" placeholder="Observa√ß√µes gerais sobre o assessorado..."></textarea></div><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-5 mb-6"><h5 class="font-bold text-blue-900 mb-3 flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5"></i>Automa√ß√µes que ser√£o executadas:</h5><ul class="text-sm text-blue-800 space-y-2 ml-6 list-disc"><li>Gera√ß√£o autom√°tica de ID √∫nico</li><li>Cria√ß√£o de pasta no Google Drive com 5 subpastas</li><li>Cria√ß√£o de planilha espelho para acompanhamento</li><li>Registro no hist√≥rico do sistema</li><li>Notifica√ß√£o para toda equipe</li></ul></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-novo-assessorado')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl flex items-center gap-2 font-semibold shadow-lg"><span id="btn-save-spinner" class="hidden"><div class="spinner"></div></span><span id="btn-save-text"><i data-lucide="save" class="w-4 h-4 inline"></i> Salvar e Criar Estrutura</span></button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function salvarNovoAssessorado(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const dados = {
                         nome: formData.get("nome"),
                         usuario: formData.get("usuario"),
                         email: formData.get("email") || "",
                         telefone: formData.get("telefone") || "",
                         idade: formData.get("idade") || "",
                         sapato: formData.get("sapato") || "",
                         camiseta: formData.get("camiseta") || "",
                         calca: formData.get("calca") || "",
                         enderecoNome: formData.get("enderecoNome") || "",
                         rua: formData.get("rua") || "",
                         numero: formData.get("numero") || "",
                         complemento: formData.get("complemento") || "",
                         bairro: formData.get("bairro") || "",
                         cidade: formData.get("cidade") || "",
                         estado: formData.get("estado") || "",
                         cep: formData.get("cep") || "",
                         observacoes: formData.get("observacoes") || "",
                         status: "Ativo",
                         cpf: formData.get("cpf") || "",
                         rg: formData.get("rg") || "",
                         cnpj: formData.get("cnpj") || "",
                         testemunhaNome: formData.get("testemunhaNome") || "",
                         testemunhaEmail: formData.get("testemunhaEmail") || "",
                         testemunhaTelefone: formData.get("testemunhaTelefone") || "",
                         testemunhaCpf: formData.get("testemunhaCpf") || "",
                         testemunhaRg: formData.get("testemunhaRg") || "",
                         pjRazaoSocial: formData.get("pjRazaoSocial") || "",
                         pjCnpj: formData.get("pjCnpj") || "",
                         pjDataCriacao: formData.get("pjDataCriacao") || "",
                         pjEndereco: formData.get("pjEndereco") || "",
                         pjEmail: formData.get("pjEmail") || "",
                         pjInscricaoMunicipal: formData.get("pjInscricaoMunicipal") || "",
                         pjInscricaoEstadual: formData.get("pjInscricaoEstadual") || "",
                         bancoTipo: formData.get("bancoTipo") || "",
                         bancoNome: formData.get("bancoNome") || "",
                         bancoAgencia: formData.get("bancoAgencia") || "",
                         bancoConta: formData.get("bancoConta") || "",
                         bancoPix: formData.get("bancoPix") || "",
                    };
                    document.getElementById("btn-save-spinner").classList.remove("hidden");
                    document.getElementById("btn-save-text").innerHTML =
                         '<i data-lucide="loader" class="w-4 h-4 inline animate-spin"></i> Criando estrutura...';
                    form.querySelectorAll("button").forEach(function (btn) {
                         btn.disabled = true;
                    });
                    google.script.run
                         .withSuccessHandler(function (result) {
                              form.querySelectorAll("button").forEach(function (btn) {
                                   btn.disabled = false;
                              });
                              document.getElementById("btn-save-spinner").classList.add("hidden");
                              document.getElementById("btn-save-text").innerHTML =
                                   '<i data-lucide="save" class="w-4 h-4 inline"></i> Salvar e Criar Estrutura';
                              if (result.success) {
                                   closeModal("modal-novo-assessorado");
                                   showToast("‚úÖ Assessorado criado com sucesso!", "success");
                                   cachedData.assessorados = null;
                                   setTimeout(function () {
                                        renderAssessorados();
                                   }, 1000);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              form.querySelectorAll("button").forEach(function (btn) {
                                   btn.disabled = false;
                              });
                              document.getElementById("btn-save-spinner").classList.add("hidden");
                              document.getElementById("btn-save-text").innerHTML =
                                   '<i data-lucide="save" class="w-4 h-4 inline"></i> Salvar e Criar Estrutura';
                              showToast("‚ùå Erro ao criar assessorado", "error");
                              console.error("Erro:", error);
                         })
                         .criarAssessorado(dados);
               }
               function editarAssessorado(id) {
                    showLoading("Carregando dados...");
                    google.script.run
                         .withSuccessHandler(function (assessorado) {
                              hideLoading();
                              if (assessorado) {
                                   renderModalEditarAssessorado(assessorado);
                              } else {
                                   showToast("‚ùå Assessorado n√£o encontrado", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao carregar dados", "error");
                              console.error(error);
                         })
                         .getAssessorado(id);
               }
               function renderModalEditarAssessorado(a) {
                    const modalHTML = `<div id="modal-editar-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="edit" class="w-5 h-5"></i>Editar Assessorado</h3><p class="text-sm text-slate-300 mt-1">ID: ${a.id} - ${a.nome}</p></div><button onclick="closeModal('modal-editar-assessorado')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-editar-assessorado" onsubmit="salvarEdicaoAssessorado(event)"><input type="hidden" name="id" value="${a.id}"><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome *</label><input type="text" name="nome" value="${a.nome}" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Usu√°rio *</label><input type="text" name="usuario" value="${a.usuario}" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"></div></div><div class="grid grid-cols-3 gap-4 mb-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" name="email" value="${a.email || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Telefone</label><input type="tel" name="telefone" value="${a.telefone || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Idade</label><input type="number" name="idade" value="${a.idade || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-3 gap-4 mb-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Sapato</label><input type="text" name="sapato" value="${a.sapato || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Camiseta</label><input type="text" name="camiseta" value="${a.camiseta || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Cal√ßa</label><input type="text" name="calca" value="${a.calca || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="mb-4"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="file-text" class="w-5 h-5"></i>Dados Pessoais</h4><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" name="cpf" value="${a.cpf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" name="rg" value="${a.rg || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" name="cnpj" value="${a.cnpj || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="mb-4"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="users" class="w-5 h-5"></i>Testemunha</h4><div class="grid grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome Completo</label><input type="text" name="testemunhaNome" value="${a.testemunhaNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" name="testemunhaEmail" value="${a.testemunhaEmail || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Telefone</label><input type="tel" name="testemunhaTelefone" value="${a.testemunhaTelefone || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" name="testemunhaCpf" value="${a.testemunhaCpf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" name="testemunhaRg" value="${a.testemunhaRg || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="mb-4"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="building" class="w-5 h-5"></i>Pessoa Jur√≠dica</h4><div class="grid grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Raz√£o Social</label><input type="text" name="pjRazaoSocial" value="${a.pjRazaoSocial || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" name="pjCnpj" value="${a.pjCnpj || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-3 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data de Cria√ß√£o</label><input type="text" name="pjDataCriacao" value="${a.pjDataCriacao || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" name="pjEmail" value="${a.pjEmail || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Endere√ßo</label><input type="text" name="pjEndereco" value="${a.pjEndereco || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Municipal</label><input type="text" name="pjInscricaoMunicipal" value="${a.pjInscricaoMunicipal || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Estadual</label><input type="text" name="pjInscricaoEstadual" value="${a.pjInscricaoEstadual || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="mb-4"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="credit-card" class="w-5 h-5"></i>Conta Banc√°ria</h4><div class="grid grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Conta</label><select name="bancoTipo" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="PF" ${a.bancoTipo === "PF" ? "selected" : ""}>Pessoa F√≠sica</option><option value="PJ" ${a.bancoTipo === "PJ" ? "selected" : ""}>Pessoa Jur√≠dica</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Banco</label><input type="text" name="bancoNome" value="${a.bancoNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-3 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Ag√™ncia</label><input type="text" name="bancoAgencia" value="${a.bancoAgencia || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Conta</label><input type="text" name="bancoConta" value="${a.bancoConta || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">PIX</label><input type="text" name="bancoPix" value="${a.bancoPix || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes</label><textarea name="observacoes" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${a.observacoes || ""}</textarea></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-editar-assessorado')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg"><i data-lucide="save" class="w-4 h-4 inline"></i> Salvar</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function salvarEdicaoAssessorado(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const dados = {
                         id: formData.get("id"),
                         nome: formData.get("nome"),
                         usuario: formData.get("usuario"),
                         email: formData.get("email"),
                         telefone: formData.get("telefone"),
                         idade: formData.get("idade"),
                         sapato: formData.get("sapato"),
                         camiseta: formData.get("camiseta"),
                         calca: formData.get("calca"),
                         enderecoNome: formData.get("enderecoNome"),
                         rua: formData.get("rua"),
                         numero: formData.get("numero"),
                         complemento: formData.get("complemento"),
                         bairro: formData.get("bairro"),
                         cidade: formData.get("cidade"),
                         estado: formData.get("estado"),
                         cep: formData.get("cep"),
                         observacoes: formData.get("observacoes"),
                         cpf: formData.get("cpf"),
                         rg: formData.get("rg"),
                         cnpj: formData.get("cnpj"),
                         testemunhaNome: formData.get("testemunhaNome"),
                         testemunhaEmail: formData.get("testemunhaEmail"),
                         testemunhaTelefone: formData.get("testemunhaTelefone"),
                         testemunhaCpf: formData.get("testemunhaCpf"),
                         testemunhaRg: formData.get("testemunhaRg"),
                         pjRazaoSocial: formData.get("pjRazaoSocial"),
                         pjCnpj: formData.get("pjCnpj"),
                         pjDataCriacao: formData.get("pjDataCriacao"),
                         pjEndereco: formData.get("pjEndereco"),
                         pjEmail: formData.get("pjEmail"),
                         pjInscricaoMunicipal: formData.get("pjInscricaoMunicipal"),
                         pjInscricaoEstadual: formData.get("pjInscricaoEstadual"),
                         bancoTipo: formData.get("bancoTipo"),
                         bancoNome: formData.get("bancoNome"),
                         bancoAgencia: formData.get("bancoAgencia"),
                         bancoConta: formData.get("bancoConta"),
                         bancoPix: formData.get("bancoPix"),
                    };
                    google.script.run
                         .withSuccessHandler(function (result) {
                              if (result.success) {
                                   closeModal("modal-editar-assessorado");
                                   showToast("‚úÖ Assessorado atualizado!", "success");
                                   cachedData.assessorados = null;
                                   setTimeout(function () {
                                        renderAssessorados();
                                   }, 500);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              showToast("‚ùå Erro ao salvar", "error");
                              console.error(error);
                         })
                         .atualizarAssessorado(dados);
               }
               function verDetalhesAssessorado(id) {
                    showLoading("Carregando informa√ß√µes...");
                    google.script.run
                         .withSuccessHandler(function (assessorado) {
                              hideLoading();
                              if (assessorado) {
                                   renderModalDetalhesAssessorado(assessorado);
                              } else {
                                   showToast("‚ùå Assessorado n√£o encontrado", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao carregar dados", "error");
                              console.error(error);
                         })
                         .getAssessorado(id);
               }
               function renderModalDetalhesAssessorado(a) {
                    const modalHTML = `<div id="modal-detalhes-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark via-slate-800 to-litte-dark text-white px-6 py-5 flex items-center justify-between rounded-t-3xl shadow-lg"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="user" class="w-5 h-5"></i>Perfil do Influenciador</h3><p class="text-sm text-slate-300 mt-1">${a.nome} (@${a.usuario})</p></div><button onclick="closeModal('modal-detalhes-assessorado')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><div class="bg-gradient-to-r from-litte-dark to-slate-800 text-white rounded-2xl p-6 mb-6 shadow-xl"><div class="flex items-center gap-6"><div class="w-24 h-24 bg-white rounded-2xl flex items-center justify-center text-4xl font-black text-litte-dark shadow-lg">${a.nome.charAt(0).toUpperCase()}</div><div class="flex-1"><h2 class="text-3xl font-black mb-2">${a.nome}</h2><div class="flex items-center gap-4 text-slate-300"><span class="flex items-center gap-2"><i data-lucide="at-sign" class="w-4 h-4"></i>@${a.usuario}</span><span class="flex items-center gap-2"><i data-lucide="hash" class="w-4 h-4"></i>${a.id}</span><span class="px-3 py-1 ${a.status === "Ativo" ? "bg-green-500" : "bg-red-500"} rounded-full text-sm font-bold">${a.status === "Ativo" ? "‚úì" : "‚úó"} ${a.status}</span></div></div></div></div><div class="flex border-b-2 border-slate-200 mb-6"><button class="tab-btn-detalhes px-6 py-3 font-semibold text-slate-700 border-b-4 border-litte-dark" data-tab="visao-geral" onclick="switchTabDetalhes('visao-geral')">Vis√£o Geral</button><button class="tab-btn-detalhes px-6 py-3 font-semibold text-slate-400 border-b-4 border-transparent hover:text-slate-700 transition-all" data-tab="info-pessoais" onclick="switchTabDetalhes('info-pessoais')">Informa√ß√µes Pessoais</button></div><div id="tab-visao-geral" class="tab-content-detalhes"><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="mail" class="w-5 h-5"></i>Informa√ß√µes de Contato</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Email</p><p class="font-semibold text-slate-900">${a.email || "--"}</p>${a.email ? `<a href="mailto:${a.email}" class="text-xs text-blue-600 hover:underline font-medium">Enviar email</a>` : ""}</div><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Telefone</p><p class="font-semibold text-slate-900">${a.telefone || "--"}</p>${a.telefone ? `<a href="https://wa.me/55${a.telefone.replace(/\D/g, "")}" target="_blank" class="text-xs text-green-600 hover:underline font-medium flex items-center gap-1"><i data-lucide="message-circle" class="w-3 h-3"></i>Abrir WhatsApp</a>` : ""}</div><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Idade</p><p class="font-semibold text-slate-900">${a.idade || "--"}${a.idade ? " anos" : ""}</p></div></div></div><div class="bg-purple-50 border-2 border-purple-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="shirt" class="w-5 h-5"></i>Medidas e Tamanhos</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Camiseta</p><p class="font-semibold text-slate-900">${a.camiseta || "--"}</p></div><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Cal√ßa</p><p class="font-semibold text-slate-900">${a.calca || "--"}</p></div><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Sapato</p><p class="font-semibold text-slate-900">${a.sapato || "--"}</p></div></div></div></div>${a.rua || a.cidade ? `<div class="bg-green-50 border-2 border-green-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="map-pin" class="w-5 h-5"></i>Endere√ßo de Entrega</h4><div class="bg-white p-4 rounded-xl border border-green-100 space-y-2">${a.enderecoNome ? `<p class="font-black text-lg text-slate-900">${a.enderecoNome}</p>` : ""}<p class="text-slate-700">${a.rua || "--"}, ${a.numero || "s/n"}</p>${a.complemento ? `<p class="text-sm text-slate-600">Complemento: ${a.complemento}</p>` : ""}<p class="text-slate-700">${a.bairro || "--"} - ${a.cidade || "--"}/${a.estado || "--"}</p><p class="font-semibold text-slate-900">CEP: ${a.cep || "--"}</p></div></div>` : ""}<div class="bg-slate-50 border-2 border-slate-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="link" class="w-5 h-5"></i>Links e Informa√ß√µes do Sistema</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-slate-200"><p class="text-xs text-slate-500 mb-2 font-semibold flex items-center gap-1"><i data-lucide="folder" class="w-4 h-4"></i>Pasta no Drive</p>${a.urlPastaDrive ? `<a href="${a.urlPastaDrive}" target="_blank" class="text-litte-green hover:text-litte-dark underline font-semibold flex items-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i>Abrir Pasta do Drive</a>` : `<div class="flex items-center justify-between"><p class="text-sm text-slate-500">Pasta n√£o criada</p><button onclick="criarPastaDriveManual('${a.id}','${a.nome}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-xl text-xs font-bold transition-all shadow">Criar agora</button></div>`}</div><div class="bg-white p-3 rounded-xl border border-slate-200"><p class="text-xs text-slate-500 mb-2 font-semibold flex items-center gap-1"><i data-lucide="table" class="w-4 h-4"></i>Planilha Espelho</p>${a.linkPlanilhaEspelho ? `<a href="${a.linkPlanilhaEspelho}" target="_blank" class="text-litte-green hover:text-litte-dark underline font-semibold flex items-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i>Abrir Planilha Espelho</a>` : `<div class="flex items-center justify-between"><p class="text-sm text-slate-500">Planilha n√£o criada</p><button onclick="criarPlanilhaManual('${a.id}','${a.nome}')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-xl text-xs font-bold transition-all shadow">Criar agora</button></div>`}</div></div></div></div><div id="tab-info-pessoais" class="tab-content-detalhes hidden"><div class="bg-amber-50 border-2 border-amber-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="file-text" class="w-5 h-5"></i>Dados Pessoais</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" id="edit-cpf" value="${a.cpf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="000.000.000-00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" id="edit-rg" value="${a.rg || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000-0"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" id="edit-cnpj" value="${a.cnpj || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000/0000-00"></div></div></div><div class="bg-indigo-50 border-2 border-indigo-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="users" class="w-5 h-5"></i>Testemunha</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome Completo</label><input type="text" id="edit-testemunhaNome" value="${a.testemunhaNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Nome da testemunha"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" id="edit-testemunhaEmail" value="${a.testemunhaEmail || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="email@exemplo.com"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Telefone</label><input type="tel" id="edit-testemunhaTelefone" value="${a.testemunhaTelefone || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="(00) 00000-0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" id="edit-testemunhaCpf" value="${a.testemunhaCpf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="000.000.000-00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" id="edit-testemunhaRg" value="${a.testemunhaRg || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000-0"></div></div></div><div class="bg-cyan-50 border-2 border-cyan-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="building" class="w-5 h-5"></i>Pessoa Jur√≠dica</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Raz√£o Social</label><input type="text" id="edit-pjRazaoSocial" value="${a.pjRazaoSocial || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Nome da empresa"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" id="edit-pjCnpj" value="${a.pjCnpj || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000/0000-00"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data de Cria√ß√£o</label><input type="text" id="edit-pjDataCriacao" value="${a.pjDataCriacao || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="DD/MM/AAAA"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" id="edit-pjEmail" value="${a.pjEmail || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="contato@empresa.com"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Endere√ßo</label><input type="text" id="edit-pjEndereco" value="${a.pjEndereco || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Endere√ßo completo"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Municipal</label><input type="text" id="edit-pjInscricaoMunicipal" value="${a.pjInscricaoMunicipal || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="N√∫mero da inscri√ß√£o"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Estadual</label><input type="text" id="edit-pjInscricaoEstadual" value="${a.pjInscricaoEstadual || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="N√∫mero da inscri√ß√£o"></div></div></div><div class="bg-emerald-50 border-2 border-emerald-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="credit-card" class="w-5 h-5"></i>Conta Banc√°ria</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Conta</label><select id="edit-bancoTipo" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option><option value="PF" ${a.bancoTipo === "PF" ? "selected" : ""}>Pessoa F√≠sica</option><option value="PJ" ${a.bancoTipo === "PJ" ? "selected" : ""}>Pessoa Jur√≠dica</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Banco</label><input type="text" id="edit-bancoNome" value="${a.bancoNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Nome do banco"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Ag√™ncia</label><input type="text" id="edit-bancoAgencia" value="${a.bancoAgencia || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Conta</label><input type="text" id="edit-bancoConta" value="${a.bancoConta || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00000-0"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">PIX</label><input type="text" id="edit-bancoPix" value="${a.bancoPix || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Chave PIX"></div></div></div><div class="flex gap-3 justify-end"><button type="button" onclick="salvarInfoPessoaisAssessorado('${a.id}')" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="save" class="w-4 h-4"></i>Salvar Informa√ß√µes</button></div></div><div class="flex gap-3 justify-between pt-4 border-t-2 border-slate-200">${a.status === "Ativo" ? `<button onclick="inativarAssessorado('${a.id}')" class="px-6 py-3 border-2 border-red-500 text-red-600 rounded-xl hover:bg-red-50 font-semibold transition-all flex items-center gap-2"><i data-lucide="user-x" class="w-4 h-4"></i>Inativar</button>` : `<button onclick="ativarAssessorado('${a.id}')" class="px-6 py-3 border-2 border-green-500 text-green-600 rounded-xl hover:bg-green-50 font-semibold transition-all flex items-center gap-2"><i data-lucide="user-check" class="w-4 h-4"></i>Reativar</button>`}<div class="flex gap-3"><button onclick="closeModal('modal-detalhes-assessorado')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Fechar</button><button onclick="closeModal('modal-detalhes-assessorado');editarAssessorado('${a.id}')" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="edit" class="w-4 h-4"></i>Editar</button></div></div></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function switchTabDetalhes(tabName) {
                    document.querySelectorAll(".tab-content-detalhes").forEach(function (content) {
                         content.classList.add("hidden");
                    });
                    document.querySelectorAll(".tab-btn-detalhes").forEach(function (btn) {
                         btn.classList.remove("border-litte-dark", "text-slate-700");
                         btn.classList.add("border-transparent", "text-slate-400");
                    });
                    const targetTab = document.getElementById("tab-" + tabName);
                    if (targetTab) {
                         targetTab.classList.remove("hidden");
                    }
                    const targetBtn = document.querySelector('.tab-btn-detalhes[data-tab="' + tabName + '"]');
                    if (targetBtn) {
                         targetBtn.classList.remove("border-transparent", "text-slate-400");
                         targetBtn.classList.add("border-litte-dark", "text-slate-700");
                    }
               }
               function salvarInfoPessoaisAssessorado(id) {
                    const dados = {
                         id: id,
                         cpf: document.getElementById("edit-cpf").value,
                         rg: document.getElementById("edit-rg").value,
                         cnpj: document.getElementById("edit-cnpj").value,
                         testemunhaNome: document.getElementById("edit-testemunhaNome").value,
                         testemunhaEmail: document.getElementById("edit-testemunhaEmail").value,
                         testemunhaTelefone: document.getElementById("edit-testemunhaTelefone").value,
                         testemunhaCpf: document.getElementById("edit-testemunhaCpf").value,
                         testemunhaRg: document.getElementById("edit-testemunhaRg").value,
                         pjRazaoSocial: document.getElementById("edit-pjRazaoSocial").value,
                         pjCnpj: document.getElementById("edit-pjCnpj").value,
                         pjDataCriacao: document.getElementById("edit-pjDataCriacao").value,
                         pjEndereco: document.getElementById("edit-pjEndereco").value,
                         pjEmail: document.getElementById("edit-pjEmail").value,
                         pjInscricaoMunicipal: document.getElementById("edit-pjInscricaoMunicipal").value,
                         pjInscricaoEstadual: document.getElementById("edit-pjInscricaoEstadual").value,
                         bancoTipo: document.getElementById("edit-bancoTipo").value,
                         bancoNome: document.getElementById("edit-bancoNome").value,
                         bancoAgencia: document.getElementById("edit-bancoAgencia").value,
                         bancoConta: document.getElementById("edit-bancoConta").value,
                         bancoPix: document.getElementById("edit-bancoPix").value,
                    };
                    const saveBtn = event.target;
                    const originalHTML = saveBtn.innerHTML;
                    saveBtn.disabled = true;
                    saveBtn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Salvando...';
                    lucide.createIcons();
                    google.script.run
                         .withSuccessHandler(function (result) {
                              saveBtn.disabled = false;
                              saveBtn.innerHTML = originalHTML;
                              lucide.createIcons();
                              if (result.success) {
                                   showToast("‚úÖ Informa√ß√µes salvas com sucesso!", "success");
                                   cachedData.assessorados = null;
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              saveBtn.disabled = false;
                              saveBtn.innerHTML = originalHTML;
                              lucide.createIcons();
                              showToast("‚ùå Erro ao salvar informa√ß√µes", "error");
                              console.error(error);
                         })
                         .atualizarAssessorado(dados);
               }
               function inativarAssessorado(id) {
                    if (!confirm("Tem certeza que deseja inativar este assessorado? Ele n√£o ser√° exclu√≠do, apenas marcado como inativo.")) {
                         return;
                    }
                    showLoading("Inativando assessorado...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-detalhes-assessorado");
                                   showToast("‚úÖ Assessorado inativado!", "success");
                                   cachedData.assessorados = null;
                                   setTimeout(function () {
                                        renderAssessorados();
                                   }, 500);
                              } else {
                                   showToast("‚ùå " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao inativar", "error");
                              console.error(error);
                         })
                         .deletarAssessorado(id);
               }
               function ativarAssessorado(id) {
                    showLoading("Reativando assessorado...");
                    google.script.run
                         .withSuccessHandler(function (assessorado) {
                              if (assessorado) {
                                   const dados = {
                                        id: id,
                                        nome: assessorado.nome,
                                        usuario: assessorado.usuario,
                                        email: assessorado.email,
                                        telefone: assessorado.telefone,
                                        idade: assessorado.idade,
                                        sapato: assessorado.sapato,
                                        camiseta: assessorado.camiseta,
                                        calca: assessorado.calca,
                                        enderecoNome: assessorado.enderecoNome,
                                        rua: assessorado.rua,
                                        numero: assessorado.numero,
                                        complemento: assessorado.complemento,
                                        bairro: assessorado.bairro,
                                        cidade: assessorado.cidade,
                                        estado: assessorado.estado,
                                        cep: assessorado.cep,
                                        observacoes: assessorado.observacoes,
                                        status: "Ativo",
                                   };
                                   google.script.run
                                        .withSuccessHandler(function (result) {
                                             hideLoading();
                                             if (result.success) {
                                                  closeModal("modal-detalhes-assessorado");
                                                  showToast("‚úÖ Assessorado reativado!", "success");
                                                  cachedData.assessorados = null;
                                                  setTimeout(function () {
                                                       renderAssessorados();
                                                  }, 500);
                                             } else {
                                                  showToast("‚ùå " + result.message, "error");
                                             }
                                        })
                                        .withFailureHandler(function (error) {
                                             hideLoading();
                                             showToast("‚ùå Erro ao reativar", "error");
                                             console.error(error);
                                        })
                                        .atualizarAssessorado(dados);
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao carregar dados", "error");
                              console.error(error);
                         })
                         .getAssessorado(id);
=======
                    const modalHTML = `<div id="modal-detalhes-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark via-slate-800 to-litte-dark text-white px-6 py-5 flex items-center justify-between rounded-t-3xl shadow-lg"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="user" class="w-5 h-5"></i>Perfil do Influenciador</h3><p class="text-sm text-slate-300 mt-1">${a.nome} (@${a.usuario})</p></div><button onclick="closeModal('modal-detalhes-assessorado')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><div class="bg-gradient-to-r from-litte-dark to-slate-800 text-white rounded-2xl p-6 mb-6 shadow-xl"><div class="flex items-center gap-6"><div class="w-24 h-24 bg-white rounded-2xl flex items-center justify-center text-4xl font-black text-litte-dark shadow-lg">${a.nome.charAt(0).toUpperCase()}</div><div class="flex-1"><h2 class="text-3xl font-black mb-2">${a.nome}</h2><div class="flex items-center gap-4 text-slate-300"><span class="flex items-center gap-2"><i data-lucide="at-sign" class="w-4 h-4"></i>@${a.usuario}</span><span class="flex items-center gap-2"><i data-lucide="hash" class="w-4 h-4"></i>${a.id}</span><span class="px-3 py-1 ${a.status === "Ativo" ? "bg-green-500" : "bg-red-500"} rounded-full text-sm font-bold">${a.status === "Ativo" ? "‚úì" : " ‚úó"} ${a.status}</span></div></div></div></div><div class="flex border-b-2 border-slate-200 mb-6"><button class="tab-btn-detalhes px-6 py-3 font-semibold text-slate-700 border-b-4 border-litte-dark" data-tab="visao-geral" onclick="switchTabDetalhes('visao-geral')">Vis√£o Geral</button><button class="tab-btn-detalhes px-6 py-3 font-semibold text-slate-400 border-b-4 border-transparent hover:text-slate-700 transition-all" data-tab="info-pessoais" onclick="switchTabDetalhes('info-pessoais')">Informa√ß√µes Pessoais</button></div><div id="tab-visao-geral" class="tab-content-detalhes"><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="mail" class="w-5 h-5"></i>Informa√ß√µes de Contato</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Email</p><p class="font-semibold text-slate-900">${a.email || "--"}</p>${a.email ? `<a href="mailto:${a.email}" class="text-xs text-blue-600 hover:underline font-medium">Enviar email</a>` : ""}</div><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Telefone</p><p class="font-semibold text-slate-900">${a.telefone || "--"}</p>${a.telefone ? `<a href="https://wa.me/55${a.telefone.replace(/\D/g, "")}" target="_blank" class="text-xs text-green-600 hover:underline font-medium flex items-center gap-1"><i data-lucide="message-circle" class="w-3 h-3"></i>Abrir WhatsApp</a>` : ""}</div><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Idade</p><p class="font-semibold text-slate-900">${a.idade || "--"}${a.idade ? " anos" : ""}</p></div></div></div><div class="bg-purple-50 border-2 border-purple-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="shirt" class="w-5 h-5"></i>Medidas e Tamanhos</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Camiseta</p><p class="font-semibold text-slate-900">${a.camiseta || "--"}</p></div><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Cal√ßa</p><p class="font-semibold text-slate-900">${a.calca || "--"}</p></div><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Sapato</p><p class="font-semibold text-slate-900">${a.sapato || "--"}</p></div></div></div></div>${a.rua || a.cidade ? `<div class="bg-green-50 border-2 border-green-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="map-pin" class="w-5 h-5"></i>Endere√ßo de Entrega</h4><div class="bg-white p-4 rounded-xl border border-green-100 space-y-2">${a.enderecoNome ? `<p class="font-black text-lg text-slate-900">${a.enderecoNome}</p>` : ""}<p class="text-slate-700">${a.rua || "--"}, ${a.numero || "s/n"}</p>${a.complemento ? `<p class="text-sm text-slate-600">Complemento: ${a.complemento}</p>` : ""}<p class="text-slate-700">${a.bairro || "--"} - ${a.cidade || "--"}/${a.estado || "--"}</p><p class="font-semibold text-slate-900">CEP: ${a.cep || "--"}</p></div></div>` : ""}<div class="bg-slate-50 border-2 border-slate-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="link" class="w-5 h-5"></i>Links e Informa√ß√µes do Sistema</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-slate-200"><p class="text-xs text-slate-500 mb-2 font-semibold flex items-center gap-1"><i data-lucide="folder" class="w-4 h-4"></i>Pasta no Drive</p>${a.urlPastaDrive ? `<a href="${a.urlPastaDrive}" target="_blank" class="text-litte-green hover:text-litte-dark underline font-semibold flex items-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i>Abrir Pasta do Drive</a>` : `<div class="flex items-center justify-between"><p class="text-sm text-slate-500">Pasta n√£o criada</p><button onclick="criarPastaDriveManual('${a.id}','${a.nome}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-xl text-xs font-bold transition-all shadow">Criar agora</button></div>`}</div><div class="bg-white p-3 rounded-xl border border-slate-200"><p class="text-xs text-slate-500 mb-2 font-semibold flex items-center gap-1"><i data-lucide="table" class="w-4 h-4"></i>Planilha Espelho</p>${a.linkPlanilhaEspelho ? `<a href="${a.linkPlanilhaEspelho}" target="_blank" class="text-litte-green hover:text-litte-dark underline font-semibold flex items-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i>Abrir Planilha Espelho</a>` : `<div class="flex items-center justify-between"><p class="text-sm text-slate-500">Planilha n√£o criada</p><button onclick="criarPlanilhaManual('${a.id}','${a.nome}')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-xl text-xs font-bold transition-all shadow">Criar agora</button></div>`}</div></div></div></div><div id="tab-info-pessoais" class="tab-content-detalhes hidden"><div class="bg-amber-50 border-2 border-amber-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="file-text" class="w-5 h-5"></i>Dados Pessoais</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" id="edit-cpf" value="${a.cpf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="000.000.000-00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" id="edit-rg" value="${a.rg || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000-0"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" id="edit-cnpj" value="${a.cnpj || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000/0000-00"></div></div></div><div class="bg-indigo-50 border-2 border-indigo-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="users" class="w-5 h-5"></i>Testemunha</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome Completo</label><input type="text" id="edit-testemunhaNome" value="${a.testemunhaNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Nome da testemunha"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" id="edit-testemunhaEmail" value="${a.testemunhaEmail || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="email@exemplo.com"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Telefone</label><input type="tel" id="edit-testemunhaTelefone" value="${a.testemunhaTelefone || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="(00) 00000-0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CPF</label><input type="text" id="edit-testemunhaCpf" value="${a.testemunhaCpf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="000.000.000-00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">RG</label><input type="text" id="edit-testemunhaRg" value="${a.testemunhaRg || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000-0"></div></div></div><div class="bg-cyan-50 border-2 border-cyan-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="building" class="w-5 h-5"></i>Pessoa Jur√≠dica</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Raz√£o Social</label><input type="text" id="edit-pjRazaoSocial" value="${a.pjRazaoSocial || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Nome da empresa"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ</label><input type="text" id="edit-pjCnpj" value="${a.pjCnpj || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00.000.000/0000-00"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data de Cria√ß√£o</label><input type="text" id="edit-pjDataCriacao" value="${a.pjDataCriacao || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="DD/MM/AAAA"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Email</label><input type="email" id="edit-pjEmail" value="${a.pjEmail || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="contato@empresa.com"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Endere√ßo</label><input type="text" id="edit-pjEndereco" value="${a.pjEndereco || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Endere√ßo completo"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Municipal</label><input type="text" id="edit-pjInscricaoMunicipal" value="${a.pjInscricaoMunicipal || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="N√∫mero da inscri√ß√£o"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Inscri√ß√£o Estadual</label><input type="text" id="edit-pjInscricaoEstadual" value="${a.pjInscricaoEstadual || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="N√∫mero da inscri√ß√£o"></div></div></div><div class="bg-emerald-50 border-2 border-emerald-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="credit-card" class="w-5 h-5"></i>Conta Banc√°ria</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Conta</label><select id="edit-bancoTipo" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option><option value="PF" ${a.bancoTipo === "PF" ? "selected" : ""}>Pessoa F√≠sica</option><option value="PJ" ${a.bancoTipo === "PJ" ? "selected" : ""}>Pessoa Jur√≠dica</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Banco</label><input type="text" id="edit-bancoNome" value="${a.bancoNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Nome do banco"></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Ag√™ncia</label><input type="text" id="edit-bancoAgencia" value="${a.bancoAgencia || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="0000"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Conta</label><input type="text" id="edit-bancoConta" value="${a.bancoConta || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="00000-0"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">PIX</label><input type="text" id="edit-bancoPix" value="${a.bancoPix || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Chave PIX"></div></div></div><div class="flex gap-3 justify-end"><button type="button" onclick="salvarInfoPessoaisAssessorado('${a.id}')" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="save" class="w-4 h-4"></i>Salvar Informa√ß√µes</button></div></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button onclick="closeModal('modal-detalhes-assessorado')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Fechar</button><button onclick="closeModal('modal-detalhes-assessorado');editarAssessorado('${a.id}')" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="edit" class="w-4 h-4"></i>Editar Assessorado</button></div></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function switchTabDetalhes(tabName) {
                    document.querySelectorAll(".tab-content-detalhes").forEach(function (content) {
                         content.classList.add("hidden");
                    });
                    document.querySelectorAll(".tab-btn-detalhes").forEach(function (btn) {
                         btn.classList.remove("border-litte-dark", "text-slate-700");
                         btn.classList.add("border-transparent", "text-slate-400");
                    });
                    const targetTab = document.getElementById("tab-" + tabName);
                    if (targetTab) {
                         targetTab.classList.remove("hidden");
                    }
                    const targetBtn = document.querySelector('.tab-btn-detalhes[data-tab="' + tabName + '"]');
                    if (targetBtn) {
                         targetBtn.classList.remove("border-transparent", "text-slate-400");
                         targetBtn.classList.add("border-litte-dark", "text-slate-700");
                    }
               }
               function salvarInfoPessoaisAssessorado(id) {
                    const dados = {
                         id: id,
                         cpf: document.getElementById("edit-cpf").value,
                         rg: document.getElementById("edit-rg").value,
                         cnpj: document.getElementById("edit-cnpj").value,
                         testemunhaNome: document.getElementById("edit-testemunhaNome").value,
                         testemunhaEmail: document.getElementById("edit-testemunhaEmail").value,
                         testemunhaTelefone: document.getElementById("edit-testemunhaTelefone").value,
                         testemunhaCpf: document.getElementById("edit-testemunhaCpf").value,
                         testemunhaRg: document.getElementById("edit-testemunhaRg").value,
                         pjRazaoSocial: document.getElementById("edit-pjRazaoSocial").value,
                         pjCnpj: document.getElementById("edit-pjCnpj").value,
                         pjDataCriacao: document.getElementById("edit-pjDataCriacao").value,
                         pjEndereco: document.getElementById("edit-pjEndereco").value,
                         pjEmail: document.getElementById("edit-pjEmail").value,
                         pjInscricaoMunicipal: document.getElementById("edit-pjInscricaoMunicipal").value,
                         pjInscricaoEstadual: document.getElementById("edit-pjInscricaoEstadual").value,
                         bancoTipo: document.getElementById("edit-bancoTipo").value,
                         bancoNome: document.getElementById("edit-bancoNome").value,
                         bancoAgencia: document.getElementById("edit-bancoAgencia").value,
                         bancoConta: document.getElementById("edit-bancoConta").value,
                         bancoPix: document.getElementById("edit-bancoPix").value,
                    };
                    const saveBtn = event.target;
                    const originalHTML = saveBtn.innerHTML;
                    saveBtn.disabled = true;
                    saveBtn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Salvando...';
                    lucide.createIcons();
                    google.script.run
                         .withSuccessHandler(function (result) {
                              saveBtn.disabled = false;
                              saveBtn.innerHTML = originalHTML;
                              lucide.createIcons();
                              if (result.success) {
                                   showToast("‚úÖ Informa√ß√µes salvas com sucesso!", "success");
                                   cachedData.assessorados = null;
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              saveBtn.disabled = false;
                              saveBtn.innerHTML = originalHTML;
                              lucide.createIcons();
                              showToast("‚ùå Erro ao salvar informa√ß√µes", "error");
                              console.error(error);
                         })
                         .atualizarAssessorado(dados);
>>>>>>> 60f8c03 (Add 'Personal Information' tab to assessorado details modal with inline editing)
               }
               function criarPastaDriveManual(id, nome) {
                    showLoading("Criando pasta no Drive...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Pasta criada!", "success");
                                   setTimeout(() => verDetalhesAssessorado(id), 1000);
                              } else {
                                   showToast("‚ùå " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao criar pasta", "error");
                         })
                         .criarEstruturaDriveAssessorado(id, nome);
               }
               function criarPlanilhaManual(id, nome) {
                    showLoading("Criando planilha espelho...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Planilha criada!", "success");
                                   setTimeout(() => verDetalhesAssessorado(id), 1000);
                              } else {
                                   showToast("‚ùå " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao criar planilha", "error");
                         })
                         .criarPlanilhaEspelho(id, nome);
               }
               function renderProspeccoes() {
                    document.getElementById("view-title").textContent = "Prospec√ß√µes";
                    document.getElementById("view-subtitle").textContent = "Gerenciar andamentos e negocia√ß√µes";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="openModalNovoAndamento()" class="btn-primary px-4 py-2 rounded-xl flex items-center gap-2 font-medium shadow-lg"><i data-lucide="plus" class="w-4 h-4"></i><span>Novo Andamento</span></button><button onclick="refreshProspeccoes()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    showLoading("Carregando prospec√ß√µes...");
                    google.script.run
                         .withSuccessHandler(function (andamentos) {
                              hideLoading();
                              cachedData.prospeccoes = andamentos;
                              renderTabelaProspeccoes(andamentos);
                              updateLastSync();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar prospec√ß√µes", "error");
                              console.error(error);
                         })
                         .getProspeccoes();
               }
               function renderTabelaProspeccoes(andamentos) {
                    let html = `<div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b border-slate-200"><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">ID Campanha</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Influenciador</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Marca</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Fase</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Status</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Respons√°vel</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Valor Proposto</th><th class="text-center px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">A√ß√µes</th></tr></thead><tbody>`;
                    if (andamentos.length === 0) {
                         html += `<tr><td colspan="8" class="px-6 py-12 text-center text-slate-500"><div class="flex flex-col items-center gap-4"><i data-lucide="target" class="w-16 h-16 text-slate-300"></i><p class="text-lg font-medium">Nenhuma prospec√ß√£o ativa</p><button onclick="openModalNovoAndamento()" class="btn-primary px-6 py-3 rounded-xl">Criar Primeira Prospec√ß√£o</button></div></td></tr>`;
                    } else {
                         andamentos.forEach(function (a) {
                              const faseBadge = getFaseBadge(a.fase);
                              const statusBadge = getStatusBadge(a.status);
                              html += `<tr class="border-b border-slate-100 hover:bg-slate-50 transition-all"><td class="px-6 py-4"><span class="font-mono font-bold text-xs text-litte-dark">${a.idCampanha}</span></td><td class="px-6 py-4"><span class="font-semibold text-slate-900">${a.nomeInfluenciador || "--"}</span></td><td class="px-6 py-4"><span class="text-slate-700">${a.marca || "--"}</span></td><td class="px-6 py-4"><span class="badge ${faseBadge.class}">${faseBadge.icon} ${a.fase || "--"}</span></td><td class="px-6 py-4"><span class="badge ${statusBadge.class}">${statusBadge.icon} ${a.status || "--"}</span></td><td class="px-6 py-4"><span class="text-sm text-slate-600">${a.responsavel || "--"}</span></td><td class="px-6 py-4"><span class="font-semibold text-slate-900">${formatCurrency(a.valorProposto || 0)}</span></td><td class="px-6 py-4"><div class="flex items-center justify-center gap-1"><button onclick="openModalEditarAndamento('${a.idCampanha}')" class="p-2 hover:bg-purple-50 rounded-xl transition-all" title="Editar Campanha"><i data-lucide="edit-3" class="w-4 h-4 text-purple-600"></i></button><button onclick="verDetalhesAndamento('${a.idCampanha}')" class="p-2 hover:bg-blue-50 rounded-xl transition-all" title="Ver detalhes"><i data-lucide="eye" class="w-4 h-4 text-slate-600"></i></button></div></td></tr>`;
                         });
                    }
                    html += `</tbody></table></div></div>`;
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function getFaseBadge(fase) {
                    const badges = {
                         "Primeiro contato": {
                              class: "badge-info",
                              icon: '<i data-lucide="send" class="w-3 h-3"></i>',
                         },
                         Or√ßamento: { class: "badge-warning", icon: '<i data-lucide="file-text" class="w-3 h-3"></i>' },
                         Negocia√ß√£o: {
                              class: "badge-success",
                              icon: '<i data-lucide="handshake" class="w-3 h-3"></i>',
                         },
                    };
                    return badges[fase] || { class: "badge-info", icon: "" };
               }
               function getStatusBadge(status) {
                    const badges = {
                         "Aguardando resposta": {
                              class: "bg-blue-100 text-blue-800",
                              icon: '<i data-lucide="clock" class="w-3 h-3"></i>',
                         },
                         Recusado: {
                              class: "bg-red-100 text-red-800",
                              icon: '<i data-lucide="x-circle" class="w-3 h-3"></i>',
                         },
                         Fechado: {
                              class: "bg-green-100 text-green-800",
                              icon: '<i data-lucide="check-circle" class="w-3 h-3"></i>',
                         },
                    };
                    return badges[status] || { class: "bg-slate-100 text-slate-800", icon: "" };
               }
               function refreshProspeccoes() {
                    renderProspeccoes();
               }
               function openModalNovoAndamento() {
                    if (!cachedData.assessorados) {
                         showLoading("Carregando assessorados...");
                         google.script.run
                              .withSuccessHandler(function (assessorados) {
                                   hideLoading();
                                   cachedData.assessorados = assessorados;
                                   renderModalNovoAndamento(assessorados);
                              })
                              .withFailureHandler(function () {
                                   hideLoading();
                                   showToast("Erro ao carregar assessorados", "error");
                              })
                              .getAllAssessorados();
                    } else {
                         renderModalNovoAndamento(cachedData.assessorados);
                    }
               }
               function renderModalNovoAndamento(assessorados) {
                    const optionsAssessorados = assessorados
                         .filter((a) => a.status === "Ativo")
                         .map((a) => `<option value="${a.id}">${a.nome} (@${a.usuario})</option>`)
                         .join("");
                    const modalHTML = `<div id="modal-novo-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="plus-circle" class="w-5 h-5"></i>Novo Andamento</h3><p class="text-sm text-slate-300 mt-1">Registrar nova prospec√ß√£o ou fechamento</p></div><button onclick="closeModal('modal-novo-andamento')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-novo-andamento" onsubmit="salvarNovoAndamento(event)"><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="user" class="w-5 h-5"></i>Informa√ß√µes da Campanha</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Influenciador *</label><select name="idAssessorado" required onchange="atualizarNomeInfluenciador()" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option>${optionsAssessorados}</select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Marca *</label><input type="text" name="marca" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Ex: Nike"></div></div><div class="mt-4"><label class="block text-sm font-semibold text-slate-700 mb-2">Objeto da Campanha *</label><input type="text" name="objeto" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Ex: Divulga√ß√£o de novo produto"></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="bar-chart" class="w-5 h-5"></i>Status da Negocia√ß√£o</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Fase *</label><select name="fase" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option><option value="Primeiro contato">Primeiro contato</option><option value="Or√ßamento">Or√ßamento</option><option value="Negocia√ß√£o">Negocia√ß√£o</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status *</label><select name="status" required onchange="toggleCamposCondicionais()" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option><option value="Aguardando resposta">Aguardando resposta</option><option value="Recusado">Recusado</option><option value="Fechado">Fechado</option></select></div></div></div><div id="campo-ultima-mensagem" class="mb-6 hidden"><label class="block text-sm font-semibold text-slate-700 mb-2">√öltima Mensagem (obrigat√≥rio para recusado) *</label><textarea name="ultimaMensagem" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Descreva a √∫ltima mensagem trocada..."></textarea></div><div id="campos-fechado" class="mb-6 hidden"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-green-600 pb-2"><i data-lucide="check-circle" class="w-5 h-5"></i>Informa√ß√µes do Fechamento</h4><div class="bg-green-50 border-2 border-green-200 rounded-2xl p-5 mb-4"><p class="text-sm text-green-800 font-semibold mb-2">‚ö†Ô∏è Ao marcar como "Fechado", o sistema ir√°:</p><ul class="text-xs text-green-700 space-y-1 ml-4 list-disc"><li>Criar automaticamente o checklist completo</li><li>Criar registro financeiro</li><li>Criar estrutura de pastas no Drive</li><li>Sincronizar em campanhas ativas</li></ul></div><div class="space-y-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Escopo Detalhado (obrigat√≥rio) *</label><textarea name="escopo" rows="4" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Descreva o escopo completo da campanha..."></textarea></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor Fechado (obrigat√≥rio) *</label><input type="number" name="valorFechado" step="0.01" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="0.00"></div></div></div><div class="mb-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2"><i data-lucide="dollar-sign" class="w-5 h-5"></i>Valores e Respons√°veis</h4><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor Proposto</label><input type="number" name="valorProposto" step="0.01" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="0.00"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Remetente</label><select name="remetente" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option><option value="Bryan">Bryan</option><option value="Roberta">Roberta</option><option value="Anne">Anne</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Respons√°vel</label><select name="responsavel" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="">Selecione...</option><option value="Bryan">Bryan</option><option value="Roberta">Roberta</option><option value="Anne">Anne</option></select></div></div></div><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes</label><textarea name="observacoes" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Observa√ß√µes gerais sobre o andamento..."></textarea></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-novo-andamento')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="save" class="w-4 h-4"></i>Salvar Andamento</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function toggleCamposCondicionais() {
                    const status = document.querySelector('[name="status"]').value;
                    const campoUltimaMensagem = document.getElementById("campo-ultima-mensagem");
                    const camposFechado = document.getElementById("campos-fechado");
                    const inputUltimaMensagem = document.querySelector('[name="ultimaMensagem"]');
                    const inputEscopo = document.querySelector('[name="escopo"]');
                    const inputValorFechado = document.querySelector('[name="valorFechado"]');
                    if (status === "Recusado") {
                         campoUltimaMensagem.classList.remove("hidden");
                         inputUltimaMensagem.required = true;
                    } else {
                         campoUltimaMensagem.classList.add("hidden");
                         inputUltimaMensagem.required = false;
                    }
                    if (status === "Fechado") {
                         camposFechado.classList.remove("hidden");
                         inputEscopo.required = true;
                         inputValorFechado.required = true;
                    } else {
                         camposFechado.classList.add("hidden");
                         inputEscopo.required = false;
                         inputValorFechado.required = false;
                    }
               }
               function atualizarNomeInfluenciador() {
                    const select = document.querySelector('[name="idAssessorado"]');
                    const idAssessorado = select.value;
                    if (idAssessorado && cachedData.assessorados) {
                         const assessorado = cachedData.assessorados.find((a) => a.id === idAssessorado);
                         if (assessorado) {
                              const inputNome = document.createElement("input");
                              inputNome.type = "hidden";
                              inputNome.name = "nomeInfluenciador";
                              inputNome.value = assessorado.nome;
                              const oldInput = document.querySelector('[name="nomeInfluenciador"]');
                              if (oldInput) oldInput.remove();
                              document.getElementById("form-novo-andamento").appendChild(inputNome);
                         }
                    }
               }
               function salvarNovoAndamento(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const status = formData.get("status");
                    const dados = {
                         idAssessorado: formData.get("idAssessorado"),
                         nomeInfluenciador: formData.get("nomeInfluenciador") || "",
                         marca: formData.get("marca"),
                         objeto: formData.get("objeto"),
                         fase: formData.get("fase"),
                         status: status,
                         valorProposto: parseFloat(formData.get("valorProposto")) || 0,
                         remetente: formData.get("remetente") || "",
                         responsavel: formData.get("responsavel") || "",
                         observacoes: formData.get("observacoes") || "",
                    };
                    if (status === "Recusado") {
                         dados.ultimaMensagem = formData.get("ultimaMensagem");
                         if (!dados.ultimaMensagem) {
                              showToast("‚ö†Ô∏è √öltima mensagem √© obrigat√≥ria para recusado", "error");
                              return;
                         }
                    }
                    if (status === "Fechado") {
                         dados.escopo = formData.get("escopo");
                         dados.valorFechado = parseFloat(formData.get("valorFechado"));
                         if (!dados.escopo || !dados.valorFechado) {
                              showToast("‚ö†Ô∏è Escopo e valor fechado s√£o obrigat√≥rios", "error");
                              return;
                         }
                    }
                    showLoading(status === "Fechado" ? "Criando estrutura completa..." : "Salvando andamento...");
                    const funcao = status === "Fechado" ? "criarAndamentoComAutomacao" : "criarAndamentoBasico";
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-novo-andamento");
                                   showToast("‚úÖ Andamento criado com sucesso!", "success");
                                   cachedData.prospeccoes = null;
                                   setTimeout(function () {
                                        renderProspeccoes();
                                   }, 1000);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao criar andamento", "error");
                              console.error(error);
                         })
                         [funcao](dados);
               }
               function editarAndamento(idCampanha) {
                    showLoading("Carregando dados...");
                    google.script.run
                         .withSuccessHandler(function (andamento) {
                              hideLoading();
                              if (andamento) {
                                   renderModalEditarAndamento(andamento);
                              } else {
                                   showToast("‚ùå Andamento n√£o encontrado", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao carregar dados", "error");
                              console.error(error);
                         })
                         .getAndamento(idCampanha);
               }
               function renderModalEditarAndamento(a) {
                    const modalHTML = `<div id="modal-editar-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="edit" class="w-5 h-5"></i>Editar Andamento</h3><p class="text-sm text-slate-300 mt-1">ID: ${a.idCampanha}</p></div><button onclick="closeModal('modal-editar-andamento')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-editar-andamento" onsubmit="salvarEdicaoAndamento(event)"><input type="hidden" name="idCampanha" value="${a.idCampanha}"><input type="hidden" name="idAssessorado" value="${a.idAssessorado}"><div class="bg-slate-100 p-4 rounded-2xl mb-4"><p class="text-sm text-slate-700"><strong>Influenciador:</strong> ${a.nomeInfluenciador} (${a.idAssessorado})</p><p class="text-xs text-slate-500 mt-1">ID do assessorado n√£o pode ser alterado</p></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Marca *</label><input type="text" name="marca" value="${a.marca}" required class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Objeto *</label><input type="text" name="objeto" value="${a.objeto}" required class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-2 gap-4 mb-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Fase *</label><select name="fase" required class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="Primeiro contato" ${a.fase === "Primeiro contato" ? "selected" : ""}>Primeiro contato</option><option value="Or√ßamento" ${a.fase === "Or√ßamento" ? "selected" : ""}>Or√ßamento</option><option value="Negocia√ß√£o" ${a.fase === "Negocia√ß√£o" ? "selected" : ""}>Negocia√ß√£o</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status *</label><select name="status" required onchange="toggleCamposCondicionaisEdicao()" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="Aguardando resposta" ${a.status === "Aguardando resposta" ? "selected" : ""}>Aguardando resposta</option><option value="Recusado" ${a.status === "Recusado" ? "selected" : ""}>Recusado</option><option value="Fechado" ${a.status === "Fechado" ? "selected" : ""}>Fechado</option></select></div></div><div id="campo-ultima-mensagem-edit" class="mb-4 ${a.status === "Recusado" ? "" : "hidden"}"><label class="block text-sm font-semibold text-slate-700 mb-2">√öltima Mensagem *</label><textarea name="ultimaMensagem" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${a.ultimaMensagem || ""}</textarea></div><div id="campos-fechado-edit" class="mb-4 ${a.status === "Fechado" ? "" : "hidden"}"><div class="bg-green-50 border-2 border-green-200 rounded-2xl p-4 mb-4"><p class="text-sm text-green-800 font-semibold">‚ö†Ô∏è Mudando para "Fechado" ir√° criar checklist, financeiro e Drive automaticamente.</p></div><div class="space-y-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Escopo *</label><textarea name="escopo" rows="4" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${a.escopo || ""}</textarea></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor Fechado *</label><input type="number" name="valorFechado" step="0.01" value="${a.valorFechado || 0}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="grid grid-cols-3 gap-4 mb-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor Proposto</label><input type="number" name="valorProposto" step="0.01" value="${a.valorProposto || 0}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Remetente</label><select name="remetente" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="Bryan" ${a.remetente === "Bryan" ? "selected" : ""}>Bryan</option><option value="Roberta" ${a.remetente === "Roberta" ? "selected" : ""}>Roberta</option><option value="Anne" ${a.remetente === "Anne" ? "selected" : ""}>Anne</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Respons√°vel</label><select name="responsavel" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="Bryan" ${a.responsavel === "Bryan" ? "selected" : ""}>Bryan</option><option value="Roberta" ${a.responsavel === "Roberta" ? "selected" : ""}>Roberta</option><option value="Anne" ${a.responsavel === "Anne" ? "selected" : ""}>Anne</option></select></div></div><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes</label><textarea name="observacoes" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${a.observacoes || ""}</textarea></div><input type="hidden" name="statusAnterior" value="${a.status}"><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-editar-andamento')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg"><i data-lucide="save" class="w-4 h-4 inline"></i> Salvar Altera√ß√µes</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function toggleCamposCondicionaisEdicao() {
                    const status = document.querySelector('[name="status"]').value;
                    const campoUltimaMensagem = document.getElementById("campo-ultima-mensagem-edit");
                    const camposFechado = document.getElementById("campos-fechado-edit");
                    if (status === "Recusado") {
                         campoUltimaMensagem.classList.remove("hidden");
                    } else {
                         campoUltimaMensagem.classList.add("hidden");
                    }
                    if (status === "Fechado") {
                         camposFechado.classList.remove("hidden");
                    } else {
                         camposFechado.classList.add("hidden");
                    }
               }
               function salvarEdicaoAndamento(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const status = formData.get("status");
                    const statusAnterior = formData.get("statusAnterior");
                    const dados = {
                         idCampanha: formData.get("idCampanha"),
                         idAssessorado: formData.get("idAssessorado"),
                         marca: formData.get("marca"),
                         objeto: formData.get("objeto"),
                         fase: formData.get("fase"),
                         status: status,
                         valorProposto: parseFloat(formData.get("valorProposto")) || 0,
                         remetente: formData.get("remetente"),
                         responsavel: formData.get("responsavel"),
                         observacoes: formData.get("observacoes"),
                    };
                    if (status === "Recusado") {
                         dados.ultimaMensagem = formData.get("ultimaMensagem");
                    }
                    if (status === "Fechado") {
                         dados.escopo = formData.get("escopo");
                         dados.valorFechado = parseFloat(formData.get("valorFechado"));
                    }
                    showLoading("Salvando altera√ß√µes...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-editar-andamento");
                                   showToast("‚úÖ Andamento atualizado!", "success");
                                   cachedData.prospeccoes = null;
                                   setTimeout(function () {
                                        renderProspeccoes();
                                   }, 1000);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar", "error");
                              console.error(error);
                         })
                         .atualizarAndamento(dados);
               }
               function verDetalhesAndamento(idCampanha) {
                    showLoading("Carregando detalhes...");
                    google.script.run
                         .withSuccessHandler(function (andamento) {
                              hideLoading();
                              if (andamento) {
                                   renderModalDetalhesAndamento(andamento);
                              } else {
                                   showToast("‚ùå Andamento n√£o encontrado", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao carregar detalhes", "error");
                              console.error(error);
                         })
                         .getAndamento(idCampanha);
               }
               function renderModalDetalhesAndamento(a) {
                    const modalHTML = `<div id="modal-detalhes-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark via-slate-800 to-litte-dark text-white px-6 py-5 flex items-center justify-between rounded-t-3xl shadow-lg"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="file-text" class="w-5 h-5"></i>Detalhes do Andamento</h3><p class="text-sm text-slate-300 mt-1">Campanha: ${a.idCampanha}</p></div><button onclick="closeModal('modal-detalhes-andamento')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><div class="bg-gradient-to-r from-litte-dark to-slate-800 text-white rounded-2xl p-6 mb-6 shadow-xl"><div class="flex justify-between items-start"><div class="flex-1"><h2 class="text-2xl font-black mb-2">${a.marca}</h2><p class="text-slate-300 text-lg mb-3">${a.objeto}</p><div class="flex gap-2">${getFaseBadge(a.fase).icon ? `<span class="px-3 py-1 bg-white/20 rounded-full text-sm font-bold">${a.fase}</span>` : ""}<span class="px-3 py-1 ${a.status === "Fechado" ? "bg-green-500" : a.status === "Recusado" ? "bg-red-500" : "bg-blue-500"} rounded-full text-sm font-bold">${a.status}</span></div></div><div class="text-right"><p class="text-xs text-slate-400">ID Campanha</p><p class="font-mono text-xl font-bold">${a.idCampanha}</p></div></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="user" class="w-5 h-5"></i>Informa√ß√µes do Influenciador</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Nome</p><p class="font-bold text-slate-900">${a.nomeInfluenciador || "--"}</p></div><div class="bg-white p-3 rounded-xl border border-blue-100"><p class="text-xs text-slate-500 mb-1 font-semibold">ID Assessorado</p><p class="font-mono text-sm text-slate-900">${a.idAssessorado}</p></div></div></div><div class="bg-purple-50 border-2 border-purple-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="dollar-sign" class="w-5 h-5"></i>Valores</h4><div class="space-y-3"><div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Valor Proposto</p><p class="font-bold text-2xl text-purple-700">${formatCurrency(a.valorProposto || 0)}</p></div>${a.valorFechado ? `<div class="bg-white p-3 rounded-xl border border-purple-100"><p class="text-xs text-slate-500 mb-1 font-semibold">Valor Fechado</p><p class="font-bold text-2xl text-green-600">${formatCurrency(a.valorFechado)}</p></div>` : ""}</div></div></div>${a.escopo ? `<div class="bg-green-50 border-2 border-green-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-3 flex items-center gap-2"><i data-lucide="file-text" class="w-5 h-5"></i>Escopo da Campanha</h4><div class="bg-white p-4 rounded-xl border border-green-100"><p class="text-slate-700 whitespace-pre-wrap">${a.escopo}</p></div></div>` : ""}<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div class="bg-slate-50 border-2 border-slate-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-3">Respons√°veis</h4><div class="space-y-2"><p class="text-sm"><span class="font-semibold text-slate-600">Remetente:</span> ${a.remetente || "--"}</p><p class="text-sm"><span class="font-semibold text-slate-600">Respons√°vel:</span> ${a.responsavel || "--"}</p></div></div><div class="bg-slate-50 border-2 border-slate-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-3">Datas</h4><div class="space-y-2"><p class="text-sm"><span class="font-semibold text-slate-600">Cria√ß√£o:</span> ${formatDateTime(a.dataCriacao)}</p><p class="text-sm"><span class="font-semibold text-slate-600">√öltima Atualiza√ß√£o:</span> ${formatDateTime(a.dataUltimaAtualizacao)}</p></div></div></div>${a.observacoes ? `<div class="bg-yellow-50 border-2 border-yellow-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-3 flex items-center gap-2"><i data-lucide="message-square" class="w-5 h-5"></i>Observa√ß√µes</h4><p class="text-slate-700">${a.observacoes}</p></div>` : ""}${a.ultimaMensagem ? `<div class="bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-3 flex items-center gap-2"><i data-lucide="message-circle" class="w-5 h-5"></i>√öltima Mensagem</h4><p class="text-slate-700">${a.ultimaMensagem}</p></div>` : ""}${a.urlPastaDrive ? `<div class="bg-orange-50 border-2 border-orange-200 rounded-2xl p-6 mb-6"><h4 class="text-lg font-bold text-slate-900 mb-3 flex items-center gap-2"><i data-lucide="folder" class="w-5 h-5"></i>Pasta no Drive</h4><a href="${a.urlPastaDrive}" target="_blank" class="text-litte-green hover:text-litte-dark underline font-semibold flex items-center gap-2"><i data-lucide="external-link" class="w-4 h-4"></i>Abrir Pasta da Campanha</a></div>` : ""}<div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button onclick="closeModal('modal-detalhes-andamento')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Fechar</button><button onclick="closeModal('modal-detalhes-andamento');editarAndamento('${a.idCampanha}')" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="edit" class="w-4 h-4"></i>Editar Andamento</button></div></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function renderCampanhas() {
                    document.getElementById("view-title").textContent = "Campanhas Ativas";
                    document.getElementById("view-subtitle").textContent = "Acompanhar execu√ß√£o das campanhas";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="refreshCampanhas()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    showLoading("Carregando campanhas ativas...");
                    google.script.run
                         .withSuccessHandler(function (campanhas) {
                              hideLoading();
                              cachedData.campanhas = campanhas;
                              renderTabelaCampanhas(campanhas);
                              updateLastSync();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar campanhas", "error");
                              console.error(error);
                         })
                         .getCampanhasAtivas();
               }
               function renderTabelaCampanhas(campanhas) {
                    let html = `<div class="mb-6 bg-white rounded-2xl border border-slate-200 p-4"><div class="flex gap-3"><input type="text" id="search-campanhas" placeholder="Buscar por ID, Influenciador ou Marca..." class="flex-1 px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" oninput="filtrarCampanhas()"><select id="filter-status-campanhas" class="px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" onchange="filtrarCampanhas()"><option value="">Todos os Status</option><option value="Em Andamento">Em Andamento</option><option value="Conclu√≠da">Conclu√≠da</option><option value="Em Atraso">Em Atraso</option></select></div></div><div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b border-slate-200"><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">ID</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Influenciador</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Marca</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Valor</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Pr√≥ximo Prazo</th><th class="text-left px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">Status</th><th class="text-center px-6 py-4 text-xs font-bold text-white uppercase tracking-wider">A√ß√µes</th></tr></thead><tbody id="tbody-campanhas">`;
                    if (campanhas.length === 0) {
                         html += `<tr><td colspan="7" class="px-6 py-12 text-center text-slate-500"><div class="flex flex-col items-center gap-4"><i data-lucide="rocket" class="w-16 h-16 text-slate-300"></i><p class="text-lg font-medium">Nenhuma campanha ativa no momento</p><p class="text-sm text-slate-400">As campanhas fechadas aparecer√£o aqui automaticamente</p></div></td></tr>`;
                    } else {
                         campanhas.forEach(function (c) {
                              const prazoClass = calcularClassePrazo(c.proximoPrazo);
                              html += `<tr class="border-b border-slate-100 hover:bg-slate-50 transition-all" data-id="${c.idCampanha}" data-influenciador="${c.nomeInfluenciador}" data-marca="${c.marca}" data-status="${c.status}"><td class="px-6 py-4"><span class="font-mono font-bold text-xs text-litte-dark">${c.idCampanha}</span></td><td class="px-6 py-4"><span class="font-semibold text-slate-900">${c.nomeInfluenciador || "--"}</span></td><td class="px-6 py-4"><span class="text-slate-700">${c.marca || "--"}</span></td><td class="px-6 py-4"><span class="font-bold text-green-700">${formatCurrency(c.valorFechado || 0)}</span></td><td class="px-6 py-4"><span class="text-sm ${prazoClass.textClass} font-semibold">${c.proximoPrazo ? formatDataSimples(c.proximoPrazo) : "--"}</span></td><td class="px-6 py-4"><span class="badge ${getStatusCampanhaBadge(c.status).class}">${c.status || "Em Andamento"}</span></td><td class="px-6 py-4"><div class="flex items-center justify-center gap-1"><button onclick="openModalEditarAndamento('${c.idCampanha}')" class="p-2 hover:bg-purple-50 rounded-xl transition-all" title="Editar Campanha"><i data-lucide="edit-3" class="w-4 h-4 text-purple-600"></i></button><button onclick="openModalChecklist('${c.idCampanha}')" class="p-2 hover:bg-blue-50 rounded-xl transition-all" title="Checklist"><i data-lucide="check-square" class="w-4 h-4 text-slate-600"></i></button><button onclick="openModalFinanceiroCampanha('${c.idCampanha}')" class="p-2 hover:bg-green-50 rounded-xl transition-all" title="Financeiro"><i data-lucide="dollar-sign" class="w-4 h-4 text-slate-600"></i></button><button onclick="abrirPastaDriveCampanha('${c.idCampanha}')" class="p-2 hover:bg-orange-50 rounded-xl transition-all" title="Pasta Drive"><i data-lucide="folder" class="w-4 h-4 text-slate-600"></i></button></div></td></tr>`;
                         });
                    }
                    html += `</tbody></table></div></div>`;
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function filtrarCampanhas() {
                    const searchText = document.getElementById("search-campanhas").value.toLowerCase();
                    const filterStatus = document.getElementById("filter-status-campanhas").value;
                    const rows = document.querySelectorAll("#tbody-campanhas tr");
                    rows.forEach(function (row) {
                         const id = (row.dataset.id || "").toLowerCase();
                         const influenciador = (row.dataset.influenciador || "").toLowerCase();
                         const marca = (row.dataset.marca || "").toLowerCase();
                         const status = row.dataset.status || "";
                         const matchSearch =
                              !searchText ||
                              id.includes(searchText) ||
                              influenciador.includes(searchText) ||
                              marca.includes(searchText);
                         const matchStatus = !filterStatus || status === filterStatus;
                         if (matchSearch && matchStatus) {
                              row.style.display = "";
                         } else {
                              row.style.display = "none";
                         }
                    });
               }
               function calcularClassePrazo(data) {
                    if (!data) return { textClass: "text-slate-500" };
                    const hoje = new Date();
                    const prazo = new Date(data);
                    const diff = Math.ceil((prazo - hoje) / (1000 * 60 * 60 * 24));
                    if (diff < 0) return { textClass: "text-red-600" };
                    if (diff === 0) return { textClass: "text-orange-600" };
                    if (diff <= 3) return { textClass: "text-yellow-600" };
                    return { textClass: "text-slate-600" };
               }
               function getStatusCampanhaBadge(status) {
                    const badges = {
                         "Em Andamento": { class: "bg-blue-100 text-blue-800" },
                         Conclu√≠da: { class: "bg-green-100 text-green-800" },
                         "Em Atraso": { class: "bg-red-100 text-red-800" },
                    };
                    return badges[status] || badges["Em Andamento"];
               }
               function refreshCampanhas() {
                    renderCampanhas();
               }
               function abrirPastaDriveCampanha(idCampanha) {
                    showLoading("Buscando pasta...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success && result.url) {
                                   window.open(result.url, "_blank");
                              } else {
                                   showToast("Pasta n√£o encontrada", "error");
                              }
                         })
                         .withFailureHandler(function () {
                              hideLoading();
                              showToast("Erro ao buscar pasta", "error");
                         })
                         .buscarLinkPastaDriveCampanha(idCampanha, "");
               }
               function openModalChecklist(idCampanha) {
                    showLoading("Carregando checklist...");
                    google.script.run
                         .withSuccessHandler(function (data) {
                              hideLoading();
                              if (data.success) {
                                   renderModalChecklist(data.checklist, data.andamento);
                              } else {
                                   showToast("Erro: " + data.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar checklist", "error");
                              console.error(error);
                         })
                         .getChecklistCompletoComAndamento(idCampanha);
               }
               function renderModalChecklist(ck, and) {
                    const modalHTML = `<div id="modal-checklist" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden m-4 modal-enter flex flex-col"><div class="sticky top-0 z-20 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="clipboard-check" class="w-5 h-5"></i>Checklist da Campanha</h3><p class="text-sm text-slate-300 mt-1">${and.marca} | ${and.nomeInfluenciador} | ${ck.idCampanha}</p></div><button onclick="closeModal('modal-checklist')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="flex-1 overflow-hidden flex"><div class="w-48 bg-slate-50 border-r border-slate-200 overflow-y-auto"><div class="py-4"><button onclick="switchChecklistTab('contrato')" data-tab="contrato" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-semibold text-slate-700 bg-white border-litte-green"><i data-lucide="file-signature" class="w-4 h-4 inline mr-2"></i>Contrato</button><button onclick="switchChecklistTab('produto')" data-tab="produto" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="package" class="w-4 h-4 inline mr-2"></i>Produto</button><button onclick="switchChecklistTab('roteiro')" data-tab="roteiro" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>Roteiro</button><button onclick="switchChecklistTab('conteudo')" data-tab="conteudo" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="video" class="w-4 h-4 inline mr-2"></i>Conte√∫do</button><button onclick="switchChecklistTab('postagem')" data-tab="postagem" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="send" class="w-4 h-4 inline mr-2"></i>Postagem</button><button onclick="switchChecklistTab('metricas')" data-tab="metricas" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="bar-chart" class="w-4 h-4 inline mr-2"></i>M√©tricas</button><button onclick="switchChecklistTab('nf')" data-tab="nf" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="receipt" class="w-4 h-4 inline mr-2"></i>NF</button><button onclick="switchChecklistTab('repasse')" data-tab="repasse" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="credit-card" class="w-4 h-4 inline mr-2"></i>Repasse</button><button onclick="switchChecklistTab('observacoes')" data-tab="observacoes" class="tab-checklist w-full px-4 py-3 text-left hover:bg-white transition-all border-l-4 border-transparent font-medium text-slate-600"><i data-lucide="message-square" class="w-4 h-4 inline mr-2"></i>Observa√ß√µes</button></div></div><div class="flex-1 overflow-y-auto p-6"><form id="form-checklist"><input type="hidden" name="idCampanha" value="${ck.idCampanha}"><div id="tab-contrato" class="tab-content-checklist"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="file-signature" class="w-6 h-6"></i>Contrato</h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Precisa Contrato?</label><select name="precisaContrato" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="N√£o" ${ck.precisaContrato === "N√£o" ? "selected" : ""}>N√£o</option><option value="Sim" ${ck.precisaContrato === "Sim" ? "selected" : ""}>Sim</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status</label><select name="statusContrato" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="Pendente" ${ck.statusContrato === "Pendente" ? "selected" : ""}>Pendente</option><option value="Em An√°lise" ${ck.statusContrato === "Em An√°lise" ? "selected" : ""}>Em An√°lise</option><option value="Assinado" ${ck.statusContrato === "Assinado" ? "selected" : ""}>Assinado</option></select></div></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Prevista</label><input type="date" name="contratoDataPrevista" value="${ck.contratoDataPrevista || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Real</label><input type="date" name="contratoDataReal" value="${ck.contratoDataReal || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link do Contrato</label><input type="url" name="contratoLink" value="${ck.contratoLink || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://..."></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes</label><textarea name="contratoObservacoes" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${ck.contratoObservacoes || ""}</textarea></div><div class="flex gap-3 pt-4"><button type="button" onclick="criarEventoEtapa('contrato')" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2"><i data-lucide="calendar-plus" class="w-4 h-4"></i>Criar Evento</button></div></div></div><div id="tab-produto" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="package" class="w-6 h-6"></i>Produto</h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Precisa Produto?</label><select name="precisaProduto" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="N√£o" ${ck.precisaProduto === "N√£o" ? "selected" : ""}>N√£o</option><option value="Sim" ${ck.precisaProduto === "Sim" ? "selected" : ""}>Sim</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Quantidade</label><input type="number" name="produtoQuantidade" value="${ck.produtoQuantidade || ""}" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Nome do Produto</label><input type="text" name="produtoNome" value="${ck.produtoNome || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status do Produto</label><select name="produtoStatus" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="N√£o Enviado" ${ck.produtoStatus === "N√£o Enviado" ? "selected" : ""}>N√£o Enviado</option><option value="Enviado" ${ck.produtoStatus === "Enviado" ? "selected" : ""}>Enviado</option><option value="Em Tr√¢nsito" ${ck.produtoStatus === "Em Tr√¢nsito" ? "selected" : ""}>Em Tr√¢nsito</option><option value="Entregue" ${ck.produtoStatus === "Entregue" ? "selected" : ""}>Entregue</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Endere√ßo de Envio</label><textarea name="produtoEnderecoEnvio" rows="2" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${ck.produtoEnderecoEnvio || ""}</textarea></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data de Envio</label><input type="date" name="produtoDataEnvio" value="${ck.produtoDataEnvio || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">C√≥digo de Rastreio</label><input type="text" name="produtoCodigoRastreio" value="${ck.produtoCodigoRastreio || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link de Rastreamento</label><input type="url" name="produtoLinkRastreamento" value="${ck.produtoLinkRastreamento || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://..."></div></div></div><div id="tab-roteiro" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="file-text" class="w-6 h-6"></i>Roteiro</h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Precisa Roteiro?</label><select name="precisaRoteiro" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="N√£o" ${ck.precisaRoteiro === "N√£o" ? "selected" : ""}>N√£o</option><option value="Sim" ${ck.precisaRoteiro === "Sim" ? "selected" : ""}>Sim</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo</label><input type="text" name="roteiroTipo" value="${ck.roteiroTipo || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="Ex: V√≠deo, Post, Stories"></div></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">N√∫mero de Vers√µes</label><input type="number" name="numeroVersoes" value="${ck.numeroVersoes || ""}" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status</label><select name="roteiroStatus" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="N√£o Iniciado" ${ck.roteiroStatus === "N√£o Iniciado" ? "selected" : ""}>N√£o Iniciado</option><option value="Em Elabora√ß√£o" ${ck.roteiroStatus === "Em Elabora√ß√£o" ? "selected" : ""}>Em Elabora√ß√£o</option><option value="Aguardando Aprova√ß√£o" ${ck.roteiroStatus === "Aguardando Aprova√ß√£o" ? "selected" : ""}>Aguardando Aprova√ß√£o</option><option value="Aprovado" ${ck.roteiroStatus === "Aprovado" ? "selected" : ""}>Aprovado</option></select></div><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Prevista</label><input type="date" name="roteiroDataPrevista" value="${ck.roteiroDataPrevista || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Real</label><input type="date" name="roteiroDataReal" value="${ck.roteiroDataReal || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Aprova√ß√£o</label><input type="date" name="roteiroDataAprovacao" value="${ck.roteiroDataAprovacao || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link Pasta Google Docs</label><input type="url" name="roteiroPastaGoogleDocs" value="${ck.roteiroPastaGoogleDocs || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://..."></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Feedback do Cliente</label><textarea name="roteiroFeedbackCliente" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${ck.roteiroFeedbackCliente || ""}</textarea></div><div class="flex gap-3 pt-4"><button type="button" onclick="criarEventoEtapa('roteiro')" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2"><i data-lucide="calendar-plus" class="w-4 h-4"></i>Criar Evento</button></div></div></div><div id="tab-conteudo" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="video" class="w-6 h-6"></i>Conte√∫do</h3><div class="space-y-4"><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-4 mb-4"><div class="flex items-center justify-between mb-3"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Quantidade de Conte√∫dos</label><input type="number" id="quantidadeConteudos" name="quantidadeConteudos" value="${ck.quantidadeConteudos || 0}" min="0" max="20" class="w-32 px-4 py-2 border border-slate-300 rounded-xl" onchange="atualizarConteudosAcordeon()"></div><button type="button" onclick="atualizarConteudosAcordeon()" class="btn-secondary px-4 py-2 rounded-xl text-sm"><i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Atualizar Lista</button></div><div id="conteudos-container" class="space-y-2"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link Pasta Conte√∫do (autom√°tico)</label><input type="text" name="linkPastaConteudo" value="${ck.linkPastaConteudo || "Carregando..."}" readonly class="w-full px-4 py-3 bg-slate-100 border border-slate-300 rounded-xl text-slate-600"></div></div></div><div id="tab-postagem" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="send" class="w-6 h-6"></i>Postagem</h3><div class="space-y-4"><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status</label><select name="postagemStatus" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="N√£o Postado" ${ck.postagemStatus === "N√£o Postado" ? "selected" : ""}>N√£o Postado</option><option value="Agendado" ${ck.postagemStatus === "Agendado" ? "selected" : ""}>Agendado</option><option value="Publicado" ${ck.postagemStatus === "Publicado" ? "selected" : ""}>Publicado</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Rede Social</label><select name="postagemRedeSocial" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="Instagram" ${ck.postagemRedeSocial === "Instagram" ? "selected" : ""}>Instagram</option><option value="TikTok" ${ck.postagemRedeSocial === "TikTok" ? "selected" : ""}>TikTok</option><option value="YouTube" ${ck.postagemRedeSocial === "YouTube" ? "selected" : ""}>YouTube</option><option value="Facebook" ${ck.postagemRedeSocial === "Facebook" ? "selected" : ""}>Facebook</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo</label><select name="postagemTipo" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="Feed" ${ck.postagemTipo === "Feed" ? "selected" : ""}>Feed</option><option value="Reels" ${ck.postagemTipo === "Reels" ? "selected" : ""}>Reels</option><option value="Stories" ${ck.postagemTipo === "Stories" ? "selected" : ""}>Stories</option><option value="V√≠deo" ${ck.postagemTipo === "V√≠deo" ? "selected" : ""}>V√≠deo</option></select></div></div><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Prevista</label><input type="date" name="postagemData" value="${ck.postagemData || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Real</label><input type="date" name="dataRealPostagem" value="${ck.dataRealPostagem || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Hor√°rio</label><input type="time" name="postagemHorario" value="${ck.postagemHorario || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link da Postagem</label><input type="url" name="postagemLink" value="${ck.postagemLink || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://..."></div><div class="flex gap-3 pt-4"><button type="button" onclick="criarEventoEtapa('postagem')" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2"><i data-lucide="calendar-plus" class="w-4 h-4"></i>Criar Evento</button></div></div></div><div id="tab-metricas" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="bar-chart" class="w-6 h-6"></i>M√©tricas e Resultados</h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Prevista Coleta</label><input type="date" name="metricasDataPrevista" value="${ck.metricasDataPrevista || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status</label><select name="metricasStatus" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="N√£o Coletado" ${ck.metricasStatus === "N√£o Coletado" ? "selected" : ""}>N√£o Coletado</option><option value="Coletado" ${ck.metricasStatus === "Coletado" ? "selected" : ""}>Coletado</option><option value="Enviado ao Cliente" ${ck.metricasStatus === "Enviado ao Cliente" ? "selected" : ""}>Enviado ao Cliente</option></select></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link Pasta M√©tricas (autom√°tico)</label><input type="text" name="linkPastaMetricas" value="${ck.linkPastaMetricas || "Carregando..."}" readonly class="w-full px-4 py-3 bg-slate-100 border border-slate-300 rounded-xl text-slate-600"></div><div class="flex gap-3 pt-4"><button type="button" onclick="criarEventoEtapa('metricas')" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2"><i data-lucide="calendar-plus" class="w-4 h-4"></i>Criar Evento</button></div></div></div><div id="tab-nf" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="receipt" class="w-6 h-6"></i>Nota Fiscal</h3><div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status NF</label><select name="nfStatus" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="A Emitir" ${ck.nfStatus === "A Emitir" ? "selected" : ""}>A Emitir</option><option value="Emitida" ${ck.nfStatus === "Emitida" ? "selected" : ""}>Emitida</option><option value="Enviada" ${ck.nfStatus === "Enviada" ? "selected" : ""}>Enviada</option><option value="Recebida" ${ck.nfStatus === "Recebida" ? "selected" : ""}>Recebida</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo NF</label><select name="nfTipo" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="NFe" ${ck.nfTipo === "NFe" ? "selected" : ""}>NFe</option><option value="NFSe" ${ck.nfTipo === "NFSe" ? "selected" : ""}>NFSe</option></select></div></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">N√∫mero NF</label><input type="text" name="nfNumero" value="${ck.nfNumero || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">CNPJ Emissor</label><input type="text" name="nfCnpjEmissor" value="${ck.nfCnpjEmissor || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Emiss√£o</label><input type="date" name="nfDataEmissao" value="${ck.nfDataEmissao || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Prevista Pagamento</label><input type="date" name="nfDataPrevistaPagamento" value="${ck.nfDataPrevistaPagamento || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor NF</label><input type="number" name="nfValor" value="${ck.nfValor || ""}" step="0.01" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link PDF NF</label><input type="url" name="nfLinkPdf" value="${ck.nfLinkPdf || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://..."></div></div></div><div id="tab-repasse" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="credit-card" class="w-6 h-6"></i>Repasse ao Influenciador</h3><div class="space-y-4"><div class="bg-green-50 border-2 border-green-200 rounded-2xl p-6 mb-4"><h4 class="font-bold text-green-900 mb-3">Valores Calculados Automaticamente</h4><div class="space-y-2"><div class="flex justify-between items-center py-2 border-b border-green-200"><span class="text-slate-700 font-semibold">Valor Total da Campanha:</span><span class="text-2xl font-black text-green-700">${formatCurrency(and.valorFechado || 0)}</span></div><div class="flex justify-between items-center py-2 border-b border-green-200"><span class="text-slate-700 font-semibold">Repasse Influenciador (80%):</span><span class="text-2xl font-black text-blue-700">${formatCurrency((and.valorFechado || 0) * 0.8)}</span></div><div class="flex justify-between items-center py-2"><span class="text-slate-700 font-semibold">Taxa Litt√™ (20%):</span><span class="text-2xl font-black text-orange-700">${formatCurrency((and.valorFechado || 0) * 0.2)}</span></div></div></div><input type="hidden" name="repasseValorTotal" value="${and.valorFechado || 0}"><input type="hidden" name="repasseInfluenciador" value="${(and.valorFechado || 0) * 0.8}"><input type="hidden" name="repasseTaxaLitte" value="${(and.valorFechado || 0) * 0.2}"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status Repasse</label><select name="repasseStatus" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="">Selecione...</option><option value="Aguardando NF" ${ck.repasseStatus === "Aguardando NF" ? "selected" : ""}>Aguardando NF</option><option value="Pronto para Repasse" ${ck.repasseStatus === "Pronto para Repasse" ? "selected" : ""}>Pronto para Repasse</option><option value="Repassado" ${ck.repasseStatus === "Repassado" ? "selected" : ""}>Repassado</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Repasse</label><input type="date" name="repasseData" value="${ck.repasseData || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link Comprovante</label><input type="url" name="repasseLinkComprovante" value="${ck.repasseLinkComprovante || ""}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://..."></div><div class="flex gap-3 pt-4"><button type="button" onclick="criarEventoEtapa('repasse')" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2"><i data-lucide="calendar-plus" class="w-4 h-4"></i>Criar Evento</button></div></div></div><div id="tab-observacoes" class="tab-content-checklist hidden"><h3 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="message-square" class="w-6 h-6"></i>Observa√ß√µes da Campanha</h3><div><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes Gerais</label><textarea name="observacoesCampanha" rows="10" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="Observa√ß√µes gerais sobre a campanha...">${ck.observacoesCampanha || ""}</textarea></div></div></form></div></div><div class="sticky bottom-0 bg-white border-t-2 border-slate-200 px-6 py-4 flex justify-end gap-3"><button onclick="closeModal('modal-checklist')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Fechar</button><button onclick="salvarChecklist()" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="save" class="w-4 h-4"></i>Salvar Altera√ß√µes</button></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
                    carregarLinksPastaDrive(ck.idCampanha);
                    if (ck.quantidadeConteudos > 0) {
                         atualizarConteudosAcordeon();
                    }
               }
               function switchChecklistTab(tabName) {
                    document.querySelectorAll(".tab-checklist").forEach(function (btn) {
                         btn.classList.remove("bg-white", "border-litte-green", "font-semibold", "text-slate-700");
                         btn.classList.add("font-medium", "text-slate-600");
                    });
                    document
                         .querySelector(`[data-tab="${tabName}"]`)
                         .classList.add("bg-white", "border-litte-green", "font-semibold", "text-slate-700");
                    document.querySelectorAll(".tab-content-checklist").forEach(function (content) {
                         content.classList.add("hidden");
                    });
                    document.getElementById(`tab-${tabName}`).classList.remove("hidden");
                    lucide.createIcons();
               }
               function carregarLinksPastaDrive(idCampanha) {
                    google.script.run
                         .withSuccessHandler(function (result) {
                              if (result.success && result.url) {
                                   document.querySelector('[name="linkPastaConteudo"]').value = result.url;
                              }
                         })
                         .withFailureHandler(function (error) {
                              console.error("Erro ao carregar link da pasta de conte√∫do:", error);
                         })
                         .buscarLinkPastaDriveCampanha(idCampanha, "03_CONTEUDO_APROVACAO");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              if (result.success && result.url) {
                                   document.querySelector('[name="linkPastaMetricas"]').value = result.url;
                              }
                         })
                         .withFailureHandler(function (error) {
                              console.error("Erro ao carregar link da pasta de m√©tricas:", error);
                         })
                         .buscarLinkPastaDriveCampanha(idCampanha, "05_METRICAS_RESULTADOS");
               }
               function atualizarConteudosAcordeon() {
                    const qtd = parseInt(document.getElementById("quantidadeConteudos").value) || 0;
                    const container = document.getElementById("conteudos-container");
                    if (qtd === 0) {
                         container.innerHTML =
                              '<p class="text-slate-500 text-sm italic">Defina a quantidade de conte√∫dos acima</p>';
                         return;
                    }
                    let conteudosAtuais = [];
                    try {
                         const inputJSON = document.querySelector('[name="conteudosJSON"]');
                         if (inputJSON && inputJSON.value) {
                              conteudosAtuais = JSON.parse(inputJSON.value);
                         }
                    } catch (e) {}
                    while (conteudosAtuais.length < qtd) {
                         conteudosAtuais.push({
                              id: "CNT" + (conteudosAtuais.length + 1),
                              status: "Pendente",
                              tipo: "",
                              dataPrevEnvio: "",
                              dataRealEnvio: "",
                              dataAprovacao: "",
                         });
                    }
                    conteudosAtuais = conteudosAtuais.slice(0, qtd);
                    let html = "";
                    conteudosAtuais.forEach(function (cont, idx) {
                         html += `<div class="accordion-item bg-white border-2 border-slate-200 rounded-xl p-4"><div class="flex items-center justify-between mb-3"><h5 class="font-bold text-slate-900">Conte√∫do #${idx + 1}</h5><div class="flex gap-2"><button type="button" onclick="toggleConteudoForm(${idx})" class="p-1 hover:bg-slate-100 rounded" title="Editar"><i data-lucide="edit" class="w-4 h-4 text-slate-600"></i></button><button type="button" onclick="removerConteudo(${idx})" class="p-1 hover:bg-red-100 rounded" title="Remover"><i data-lucide="x" class="w-4 h-4 text-red-600"></i></button></div></div><div id="conteudo-form-${idx}" class="space-y-3 hidden"><div class="grid grid-cols-2 gap-3"><div><label class="block text-xs font-semibold text-slate-700 mb-1">Status</label><select class="conteudo-status w-full px-3 py-2 text-sm border border-slate-300 rounded-lg" data-idx="${idx}"><option value="Pendente" ${cont.status === "Pendente" ? "selected" : ""}>Pendente</option><option value="Em Produ√ß√£o" ${cont.status === "Em Produ√ß√£o" ? "selected" : ""}>Em Produ√ß√£o</option><option value="Enviado" ${cont.status === "Enviado" ? "selected" : ""}>Enviado</option><option value="Aprovado" ${cont.status === "Aprovado" ? "selected" : ""}>Aprovado</option></select></div><div><label class="block text-xs font-semibold text-slate-700 mb-1">Tipo</label><input type="text" class="conteudo-tipo w-full px-3 py-2 text-sm border border-slate-300 rounded-lg" value="${cont.tipo || ""}" data-idx="${idx}" placeholder="Ex: Reels"></div></div><div class="grid grid-cols-3 gap-3"><div><label class="block text-xs font-semibold text-slate-700 mb-1">Data Prev. Envio</label><input type="date" class="conteudo-dataPrevEnvio w-full px-3 py-2 text-sm border border-slate-300 rounded-lg" value="${cont.dataPrevEnvio || ""}" data-idx="${idx}"></div><div><label class="block text-xs font-semibold text-slate-700 mb-1">Data Real Envio</label><input type="date" class="conteudo-dataRealEnvio w-full px-3 py-2 text-sm border border-slate-300 rounded-lg" value="${cont.dataRealEnvio || ""}" data-idx="${idx}"></div><div><label class="block text-xs font-semibold text-slate-700 mb-1">Data Aprova√ß√£o</label><input type="date" class="conteudo-dataAprovacao w-full px-3 py-2 text-sm border border-slate-300 rounded-lg" value="${cont.dataAprovacao || ""}" data-idx="${idx}"></div></div></div><div id="conteudo-preview-${idx}" class="text-sm text-slate-600"><span class="font-semibold">${cont.tipo || "Tipo n√£o definido"}</span> ‚Ä¢ <span class="badge ${cont.status === "Aprovado" ? "badge-success" : cont.status === "Pendente" ? "badge-warning" : "badge-info"} text-xs">${cont.status}</span></div></div>`;
                    });
                    container.innerHTML = html;
                    lucide.createIcons();
               }
               function toggleConteudoForm(idx) {
                    const form = document.getElementById(`conteudo-form-${idx}`);
                    const preview = document.getElementById(`conteudo-preview-${idx}`);
                    if (form.classList.contains("hidden")) {
                         form.classList.remove("hidden");
                         preview.classList.add("hidden");
                    } else {
                         form.classList.add("hidden");
                         preview.classList.remove("hidden");
                    }
               }
               function removerConteudo(idx) {
                    const qtdInput = document.getElementById("quantidadeConteudos");
                    qtdInput.value = parseInt(qtdInput.value) - 1;
                    atualizarConteudosAcordeon();
               }
               function salvarChecklist() {
                    const form = document.getElementById("form-checklist");
                    const formData = new FormData(form);
                    const conteudos = [];
                    document.querySelectorAll(".conteudo-status").forEach(function (el) {
                         const idx = el.dataset.idx;
                         conteudos.push({
                              id: "CNT" + (parseInt(idx) + 1),
                              status: el.value,
                              tipo: document.querySelector(`.conteudo-tipo[data-idx="${idx}"]`).value,
                              dataPrevEnvio: document.querySelector(`.conteudo-dataPrevEnvio[data-idx="${idx}"]`).value,
                              dataRealEnvio: document.querySelector(`.conteudo-dataRealEnvio[data-idx="${idx}"]`).value,
                              dataAprovacao: document.querySelector(`.conteudo-dataAprovacao[data-idx="${idx}"]`).value,
                         });
                    });
                    const dados = {
                         idCampanha: formData.get("idCampanha"),
                         precisaContrato: formData.get("precisaContrato"),
                         statusContrato: formData.get("statusContrato"),
                         dataPrevAssinaturaContrato: formData.get("contratoDataPrevista"),
                         dataRealAssinaturaContrato: formData.get("contratoDataReal"),
                         linkContrato: formData.get("contratoLink"),
                         obsContrato: formData.get("contratoObservacoes"),
                         precisaProduto: formData.get("precisaProduto"),
                         nomeProduto: formData.get("produtoNome"),
                         quantidade: formData.get("produtoQuantidade"),
                         statusProduto: formData.get("produtoStatus"),
                         enderecoEnvio: formData.get("produtoEnderecoEnvio"),
                         dataEnvioProduto: formData.get("produtoDataEnvio"),
                         codigoRastreio: formData.get("produtoCodigoRastreio"),
                         linkRastreamento: formData.get("produtoLinkRastreamento"),
                         precisaRoteiro: formData.get("precisaRoteiro"),
                         tipoRoteiro: formData.get("roteiroTipo"),
                         numeroVersoes: formData.get("numeroVersoes") || "",
                         statusRoteiro: formData.get("roteiroStatus"),
                         dataPrevRoteiro: formData.get("roteiroDataPrevista"),
                         dataRealRoteiro: formData.get("roteiroDataReal"),
                         dataAprovRoteiro: formData.get("roteiroDataAprovacao"),
                         linkPastaRoteiro: formData.get("roteiroPastaGoogleDocs"),
                         feedbackClienteRoteiro: formData.get("roteiroFeedbackCliente"),
                         quantidadeConteudos: formData.get("quantidadeConteudos"),
                         conteudos: JSON.stringify(conteudos),
                         statusPostagem: formData.get("postagemStatus"),
                         redeSocial: formData.get("postagemRedeSocial"),
                         tipoPost: formData.get("postagemTipo"),
                         dataPrevPostagem: formData.get("postagemData"),
                         dataRealPostagem: formData.get("dataRealPostagem") || "",
                         horarioPostagem: formData.get("postagemHorario"),
                         linkPostagem: formData.get("postagemLink"),
                         dataPrevColetaMetricas: formData.get("metricasDataPrevista"),
                         statusMetricas: formData.get("metricasStatus"),
                         statusNF: formData.get("nfStatus"),
                         tipoNF: formData.get("nfTipo"),
                         numeroNF: formData.get("nfNumero"),
                         cnpj: formData.get("nfCnpjEmissor"),
                         dataEmissaoNF: formData.get("nfDataEmissao"),
                         dataPrevPagamento: formData.get("nfDataPrevistaPagamento"),
                         valorNF: formData.get("nfValor"),
                         linkPdfNF: formData.get("nfLinkPdf"),
                         repasseValorTotal: formData.get("repasseValorTotal"),
                         repasseInfluenciador: formData.get("repasseInfluenciador"),
                         repasseTaxaLitte: formData.get("repasseTaxaLitte"),
                         statusRepasse: formData.get("repasseStatus"),
                         dataRepasse: formData.get("repasseData"),
                         comprovanteRepasse: formData.get("repasseLinkComprovante"),
                         observacoesCampanha: formData.get("observacoesCampanha"),
                    };
                    showLoading("Salvando checklist...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Checklist salvo com sucesso!", "success");
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar checklist", "error");
                              console.error(error);
                         })
                         .updateChecklistCompleto(dados);
               }
               function openModalEditarAndamento(idCampanha) {
                    showLoading("Carregando dados da campanha...");
                    google.script.run
                         .withSuccessHandler(function (data) {
                              hideLoading();
                              if (data.success) {
                                   renderModalEditarAndamento(data.andamento, data.assessorado);
                              } else {
                                   showToast("Erro: " + data.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar dados da campanha", "error");
                              console.error(error);
                         })
                         .getAndamentoParaEdicao(idCampanha);
               }
               function renderModalEditarAndamento(and, assessorado) {
                    const modalHTML = `<div id="modal-editar-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden m-4 modal-enter flex flex-col"><div class="sticky top-0 z-20 bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-6 py-5 flex items-center justify-between"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="edit-3" class="w-5 h-5"></i>Editar Campanha</h3><p class="text-sm text-purple-100 mt-1">${and.marca} | ${assessorado.nome} | ${and.idCampanha}</p></div><button onclick="closeModal('modal-editar-andamento')" class="text-2xl hover:text-purple-200 transition-all hover:rotate-90">&times;</button></div><div class="flex-1 overflow-y-auto p-6"><form id="form-editar-andamento"><input type="hidden" name="idCampanha" value="${and.idCampanha}"><div class="space-y-6"><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-blue-900 mb-4 flex items-center gap-2"><i data-lucide="info" class="w-5 h-5"></i>Informa√ß√µes B√°sicas</h4><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Influenciador</label><input type="text" value="${assessorado.nome}" readonly class="w-full px-4 py-3 bg-slate-100 border border-slate-300 rounded-xl text-slate-600"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Instagram</label><input type="text" value="${assessorado.instagram || ''}" readonly class="w-full px-4 py-3 bg-slate-100 border border-slate-300 rounded-xl text-slate-600"></div></div><div class="grid grid-cols-2 gap-4 mt-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Marca/Cliente</label><input type="text" name="marca" value="${and.marca || ''}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" required></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Objeto da Campanha</label><input type="text" name="objetoCampanha" value="${and.objetoCampanha || ''}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="bg-green-50 border-2 border-green-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-green-900 mb-4 flex items-center gap-2"><i data-lucide="target" class="w-5 h-5"></i>Status da Campanha</h4><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Fase</label><select name="fase" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="Primeiro contato" ${and.fase === 'Primeiro contato' ? 'selected' : ''}>Primeiro contato</option><option value="Negocia√ß√£o" ${and.fase === 'Negocia√ß√£o' ? 'selected' : ''}>Negocia√ß√£o</option><option value="Proposta enviada" ${and.fase === 'Proposta enviada' ? 'selected' : ''}>Proposta enviada</option><option value="Aguardando aprova√ß√£o" ${and.fase === 'Aguardando aprova√ß√£o' ? 'selected' : ''}>Aguardando aprova√ß√£o</option><option value="Aprovado" ${and.fase === 'Aprovado' ? 'selected' : ''}>Aprovado</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Status Detalhado</label><select name="statusDetalhado" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="Aguardando resposta" ${and.statusDetalhado === 'Aguardando resposta' ? 'selected' : ''}>Aguardando resposta</option><option value="Em negocia√ß√£o" ${and.statusDetalhado === 'Em negocia√ß√£o' ? 'selected' : ''}>Em negocia√ß√£o</option><option value="Proposta aceita" ${and.statusDetalhado === 'Proposta aceita' ? 'selected' : ''}>Proposta aceita</option><option value="Fechado" ${and.statusDetalhado === 'Fechado' ? 'selected' : ''}>Fechado</option><option value="Recusado" ${and.statusDetalhado === 'Recusado' ? 'selected' : ''}>Recusado</option><option value="Pausado" ${and.statusDetalhado === 'Pausado' ? 'selected' : ''}>Pausado</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Respons√°vel Litt√™</label><select name="responsavelLitte" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="Anne" ${and.responsavelLitte === 'Anne' ? 'selected' : ''}>Anne</option><option value="Equipe" ${and.responsavelLitte === 'Equipe' ? 'selected' : ''}>Equipe</option></select></div></div></div><div class="bg-amber-50 border-2 border-amber-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-amber-900 mb-4 flex items-center gap-2"><i data-lucide="dollar-sign" class="w-5 h-5"></i>Valores</h4><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor Proposto (R$)</label><input type="number" name="valorProposto" value="${and.valorProposto || 0}" step="0.01" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Valor Fechado (R$)</label><input type="number" name="valorFechado" value="${and.valorFechado || 0}" step="0.01" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div></div><div class="bg-purple-50 border-2 border-purple-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-purple-900 mb-4 flex items-center gap-2"><i data-lucide="calendar" class="w-5 h-5"></i>Datas e Acompanhamento</h4><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Data Primeiro Contato</label><input type="date" name="dataPrimeiroContato" value="${formatarDataParaInput(and.dataPrimeiroContato)}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Pr√≥ximo Follow-up</label><input type="date" name="proximoFollowUp" value="${formatarDataParaInput(and.proximoFollowUp)}" class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div></div><div class="mt-4"><label class="block text-sm font-semibold text-slate-700 mb-2">√öltimo Retorno</label><textarea name="ultimoRetorno" rows="2" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${and.ultimoRetorno || ''}</textarea></div></div><div class="bg-slate-50 border-2 border-slate-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2"><i data-lucide="folder" class="w-5 h-5"></i>Links e Recursos</h4><div class="space-y-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Link Pasta Campanha (Drive)</label><input type="url" name="linkPastaCampanha" value="${and.linkPastaCampanha || ''}" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="https://drive.google.com/..."></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Descri√ß√£o do Escopo</label><textarea name="descricaoEscopo" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="Descreva o escopo da campanha...">${and.descricaoEscopo || ''}</textarea></div></div></div><div class="bg-gray-50 border-2 border-gray-200 rounded-2xl p-6"><h4 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2"><i data-lucide="message-square" class="w-5 h-5"></i>Comunica√ß√£o</h4><div class="space-y-4"><div><label class="block text-sm font-semibold text-slate-700 mb-2">Remetente</label><select name="remetente" class="w-full px-4 py-3 border border-slate-300 rounded-xl"><option value="Litt√™" ${and.remetente === 'Litt√™' ? 'selected' : ''}>Litt√™</option><option value="Cliente" ${and.remetente === 'Cliente' ? 'selected' : ''}>Cliente</option><option value="Influenciador" ${and.remetente === 'Influenciador' ? 'selected' : ''}>Influenciador</option></select></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">√öltima Mensagem</label><textarea name="ultimaMensagem" rows="3" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="√öltima mensagem trocada...">${and.ultimaMensagem || ''}</textarea></div><div><label class="block text-sm font-semibold text-slate-700 mb-2">Observa√ß√µes Gerais</label><textarea name="observacoes" rows="4" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="Observa√ß√µes sobre a campanha...">${and.observacoes || ''}</textarea></div></div></div></div></form></div><div class="sticky bottom-0 bg-white border-t-2 border-slate-200 px-6 py-4 flex justify-end gap-3"><button onclick="closeModal('modal-editar-andamento')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Cancelar</button><button onclick="salvarAndamento()" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="save" class="w-4 h-4"></i>Salvar Altera√ß√µes</button></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function salvarAndamento() {
                    const form = document.getElementById("form-editar-andamento");
                    const formData = new FormData(form);
                    const dados = {
                         idCampanha: formData.get("idCampanha"),
                         marca: formData.get("marca"),
                         objetoCampanha: formData.get("objetoCampanha"),
                         fase: formData.get("fase"),
                         statusDetalhado: formData.get("statusDetalhado"),
                         responsavelLitte: formData.get("responsavelLitte"),
                         valorProposto: parseFloat(formData.get("valorProposto")) || 0,
                         valorFechado: parseFloat(formData.get("valorFechado")) || 0,
                         dataPrimeiroContato: formData.get("dataPrimeiroContato"),
                         proximoFollowUp: formData.get("proximoFollowUp"),
                         ultimoRetorno: formData.get("ultimoRetorno"),
                         linkPastaCampanha: formData.get("linkPastaCampanha"),
                         descricaoEscopo: formData.get("descricaoEscopo"),
                         remetente: formData.get("remetente"),
                         ultimaMensagem: formData.get("ultimaMensagem"),
                         observacoes: formData.get("observacoes"),
                    };
                    showLoading("Salvando altera√ß√µes...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Campanha atualizada com sucesso!", "success");
                                   closeModal("modal-editar-andamento");
                                   if (typeof loadAndamentos === "function") loadAndamentos();
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar campanha", "error");
                              console.error(error);
                         })
                         .atualizarAndamento(dados);
               }
               function criarEventoEtapa(etapa) {
                    const form = document.getElementById("form-checklist");
                    const idCampanha = form.querySelector('[name="idCampanha"]').value;
                    let dataPrevista = "";
                    let nomeEtapa = "";
                    let eventIdField = "";
                    const nomeInfluenciador =
                         document.querySelector('[name="linkPastaConteudo"]')?.closest("form")?.dataset?.nome || "";
                    const marca =
                         document.querySelector('[name="linkPastaConteudo"]')?.closest("form")?.dataset?.marca || "";
                    switch (etapa) {
                         case "contrato":
                              dataPrevista = form.querySelector('[name="contratoDataPrevista"]').value;
                              nomeEtapa = "Contrato";
                              eventIdField = "eventIdContrato";
                              break;
                         case "roteiro":
                              dataPrevista = form.querySelector('[name="roteiroDataPrevista"]').value;
                              nomeEtapa = "Roteiro";
                              eventIdField = "eventIdRoteiro";
                              break;
                         case "postagem":
                              dataPrevista = form.querySelector('[name="postagemData"]').value;
                              nomeEtapa = "Postagem";
                              eventIdField = "eventIdPostagem";
                              break;
                         case "metricas":
                              dataPrevista = form.querySelector('[name="metricasDataPrevista"]').value;
                              nomeEtapa = "M√©tricas";
                              eventIdField = "eventIdMetricas";
                              break;
                         case "repasse":
                              dataPrevista = form.querySelector('[name="repasseData"]').value;
                              nomeEtapa = "Repasse";
                              eventIdField = "eventIdRepasse";
                              break;
                    }
                    if (!dataPrevista) {
                         showToast("‚ö†Ô∏è Defina a data prevista antes de criar o evento", "error");
                         return;
                    }
                    showLoading("Criando evento no calend√°rio...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              if (result.success && result.eventoId) {
                                   const dados = { idCampanha: idCampanha };
                                   dados[eventIdField] = result.eventoId;
                                   google.script.run
                                        .withSuccessHandler(function () {
                                             hideLoading();
                                             showToast("‚úÖ Evento criado no Google Calendar!", "success");
                                        })
                                        .withFailureHandler(function (error) {
                                             hideLoading();
                                             showToast("‚ö†Ô∏è Evento criado mas n√£o foi poss√≠vel salvar o ID", "error");
                                             console.error(error);
                                        })
                                        .updateChecklistCompleto(dados);
                              } else {
                                   hideLoading();
                                   showToast("‚ùå " + (result.message || "Erro ao criar evento"), "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao criar evento", "error");
                              console.error(error);
                         })
                         .criarEventoChecklistEtapa(idCampanha, nomeEtapa, dataPrevista, "", "");
               }
               function openModalFinanceiroCampanha(idCampanha) {
                    showLoading("Carregando financeiro...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   renderModalFinanceiroCampanha(result);
                              } else {
                                   showToast("Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar financeiro", "error");
                              console.error(error);
                         })
                         .getFinanceiroCampanha(idCampanha);
               }
               function renderModalFinanceiroCampanha(data) {
                    const f = data.financeiro;
                    const a = data.andamento;
                    const modalHTML = `<div id="modal-financeiro-campanha" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="dollar-sign" class="w-5 h-5"></i>Financeiro da Campanha</h3><p class="text-sm text-slate-300 mt-1">${a.marca} | ${f.idCampanha}</p></div><button onclick="closeModal('modal-financeiro-campanha')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><div class="bg-green-50 border-2 border-green-200 rounded-2xl p-5"><p class="text-xs text-slate-600 mb-1 font-semibold">Valor Total</p><p class="text-3xl font-black text-green-700">${formatCurrency(f.valorTotal || 0)}</p></div><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-5"><p class="text-xs text-slate-600 mb-1 font-semibold">Repasse 80%</p><p class="text-3xl font-black text-blue-700">${formatCurrency((f.valorTotal || 0) * 0.8)}</p></div><div class="bg-orange-50 border-2 border-orange-200 rounded-2xl p-5"><p class="text-xs text-slate-600 mb-1 font-semibold">Taxa Litt√™ 20%</p><p class="text-3xl font-black text-orange-700">${formatCurrency((f.valorTotal || 0) * 0.2)}</p></div></div><div class="bg-slate-50 border-2 border-slate-200 rounded-2xl p-6 mb-6"><h4 class="font-bold text-slate-900 mb-4">Status dos Pagamentos</h4><div class="space-y-3"><div class="flex justify-between items-center"><span class="text-slate-700 font-semibold">Pagamento Cliente:</span><span class="badge ${getStatusFinanceiroBadge(f.statusPagamento).class}">${f.statusPagamento || "--"}</span></div><div class="flex justify-between items-center"><span class="text-slate-700 font-semibold">Status Repasse:</span><span class="badge ${getStatusFinanceiroBadge(f.statusRepasse).class}">${f.statusRepasse || "--"}</span></div><div class="flex justify-between items-center"><span class="text-slate-700 font-semibold">Status NF:</span><span class="badge ${getStatusFinanceiroBadge(f.statusNF).class}">${f.statusNF || "--"}</span></div></div></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button onclick="closeModal('modal-financeiro-campanha')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Fechar</button><button onclick="closeModal('modal-financeiro-campanha');openModalChecklist('${f.idCampanha}')" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg"><i data-lucide="check-square" class="w-4 h-4 inline"></i> Abrir Checklist</button></div></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function getStatusFinanceiroBadge(status) {
                    const badges = {
                         PENDENTE: { class: "bg-yellow-100 text-yellow-800" },
                         PAGO: { class: "bg-green-100 text-green-800" },
                         "AGUARDANDO NF": { class: "bg-blue-100 text-blue-800" },
                         REPASSADO: { class: "bg-green-100 text-green-800" },
                         "A EMITIR": { class: "bg-orange-100 text-orange-800" },
                         EMITIDA: { class: "bg-green-100 text-green-800" },
                    };
                    return badges[status] || { class: "bg-slate-100 text-slate-800" };
               }
               function renderFinanceiro() {
                    document.getElementById("view-title").textContent = "Financeiro";
                    document.getElementById("view-subtitle").textContent = "Gest√£o financeira e faturamento";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="refreshFinanceiro()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    showLoading("Carregando dados financeiros...");
                    google.script.run
                         .withSuccessHandler(function (metricas) {
                              cachedData.financeiro = metricas;
                              renderDashboardFinanceiro(metricas);
                              carregarFinanceirosPorMes();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar financeiro", "error");
                              console.error(error);
                         })
                         .getMetricasFinanceiras();
               }
               function renderDashboardFinanceiro(m) {
                    let html = `<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"><div class="card-metric bg-white border-2 border-green-500 rounded-3xl p-6 hover:shadow-xl transition-all"><div class="flex items-center justify-between mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase text-slate-600 mb-2">Total Recebido</p><p class="text-4xl font-black text-green-700">${formatCurrency(m.totalRecebido || 0)}</p></div><div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="check-circle" class="w-8 h-8 text-white"></i></div></div><p class="text-xs text-slate-500 italic">Campanhas j√° pagas</p></div><div class="card-metric bg-white border-2 border-blue-500 rounded-3xl p-6 hover:shadow-xl transition-all"><div class="flex items-center justify-between mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase text-slate-600 mb-2">A Receber</p><p class="text-4xl font-black text-blue-700">${formatCurrency(m.totalReceber || 0)}</p></div><div class="w-16 h-16 bg-blue-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="clock" class="w-8 h-8 text-white"></i></div></div><p class="text-xs text-slate-500 italic">Pagamentos pendentes</p></div><div class="card-metric bg-white border-2 border-purple-500 rounded-3xl p-6 hover:shadow-xl transition-all"><div class="flex items-center justify-between mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase text-slate-600 mb-2">Faturamento Ano</p><p class="text-4xl font-black text-purple-700">${formatCurrency(m.faturamentoAno || 0)}</p></div><div class="w-16 h-16 bg-purple-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="trending-up" class="w-8 h-8 text-white"></i></div></div><p class="text-xs text-slate-500 italic">${new Date().getFullYear()}</p></div><div class="card-metric bg-white border-2 border-orange-500 rounded-3xl p-6 hover:shadow-xl transition-all"><div class="flex items-center justify-between mb-4"><div class="flex-1"><p class="text-xs font-bold uppercase text-slate-600 mb-2">Saldo Projetado</p><p class="text-4xl font-black text-orange-700">${formatCurrency(m.saldoProjetado || 0)}</p></div><div class="w-16 h-16 bg-orange-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="pie-chart" class="w-8 h-8 text-white"></i></div></div><p class="text-xs text-slate-500 italic">Recebido + A Receber</p></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"><div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-3xl p-6 shadow-xl"><h3 class="text-lg font-bold mb-4 flex items-center gap-2"><i data-lucide="user" class="w-5 h-5"></i>Bryan</h3><div class="space-y-3"><div class="bg-white/20 rounded-2xl p-4 backdrop-blur-sm"><div class="flex justify-between items-center mb-2"><span class="text-sm font-semibold">Recebido</span><span class="text-2xl font-black">${formatCurrency(m.bryanRecebido || 0)}</span></div></div><div class="bg-white/20 rounded-2xl p-4 backdrop-blur-sm"><div class="flex justify-between items-center mb-2"><span class="text-sm font-semibold">A Receber</span><span class="text-2xl font-black">${formatCurrency(m.bryanReceber || 0)}</span></div></div><div class="bg-white rounded-2xl p-4 text-blue-700"><div class="flex justify-between items-center"><span class="text-sm font-bold">Total</span><span class="text-3xl font-black">${formatCurrency(m.bryanTotal || 0)}</span></div></div></div></div><div class="bg-gradient-to-br from-pink-500 to-pink-700 text-white rounded-3xl p-6 shadow-xl"><h3 class="text-lg font-bold mb-4 flex items-center gap-2"><i data-lucide="user" class="w-5 h-5"></i>Roberta</h3><div class="space-y-3"><div class="bg-white/20 rounded-2xl p-4 backdrop-blur-sm"><div class="flex justify-between items-center mb-2"><span class="text-sm font-semibold">Recebido</span><span class="text-2xl font-black">${formatCurrency(m.robertaRecebido || 0)}</span></div></div><div class="bg-white/20 rounded-2xl p-4 backdrop-blur-sm"><div class="flex justify-between items-center mb-2"><span class="text-sm font-semibold">A Receber</span><span class="text-2xl font-black">${formatCurrency(m.robertaReceber || 0)}</span></div></div><div class="bg-white rounded-2xl p-4 text-pink-700"><div class="flex justify-between items-center"><span class="text-sm font-bold">Total</span><span class="text-3xl font-black">${formatCurrency(m.robertaTotal || 0)}</span></div></div></div></div></div><div id="financeiro-por-mes-container"></div>`;
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function carregarFinanceirosPorMes() {
                    google.script.run
                         .withSuccessHandler(function (financeiros) {
                              hideLoading();
                              renderFinanceirosPorMes(financeiros);
                              updateLastSync();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar detalhamento", "error");
                              console.error(error);
                         })
                         .getAllFinanceirosCompletos();
               }
               function renderFinanceirosPorMes(financeiros) {
                    if (!financeiros || financeiros.length === 0) {
                         document.getElementById("financeiro-por-mes-container").innerHTML =
                              `<div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-12 text-center"><i data-lucide="inbox" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i><p class="text-lg font-semibold text-slate-600">Nenhum registro financeiro</p></div>`;
                         lucide.createIcons();
                         return;
                    }
                    const financeirosPorMes = {};
                    financeiros.forEach(function (f) {
                         let mes = "Sem Data Prevista";
                         if (f.dataPrevistaPagamento) {
                              const data = new Date(f.dataPrevistaPagamento);
                              mes = data.toLocaleDateString("pt-BR", { month: "long", year: "numeric" });
                         }
                         if (!financeirosPorMes[mes]) {
                              financeirosPorMes[mes] = { campanhas: [], total: 0 };
                         }
                         financeirosPorMes[mes].campanhas.push(f);
                         financeirosPorMes[mes].total += f.valorTotal || 0;
                    });
                    const meses = Object.keys(financeirosPorMes).sort(function (a, b) {
                         if (a === "Sem Data Prevista") return 1;
                         if (b === "Sem Data Prevista") return -1;
                         const dataA = new Date(financeirosPorMes[a].campanhas[0].dataPrevistaPagamento);
                         const dataB = new Date(financeirosPorMes[b].campanhas[0].dataPrevistaPagamento);
                         return dataA - dataB;
                    });
                    let html = "";
                    meses.forEach(function (mes) {
                         const dados = financeirosPorMes[mes];
                         const isAtrasado =
                              mes !== "Sem Data Prevista" &&
                              dados.campanhas.some((f) => f.statusPagamento === "ATRASADO");
                         html += `<div class="bg-white rounded-3xl shadow-sm border-2 ${isAtrasado ? "border-red-300" : "border-slate-200"} overflow-hidden mb-6"><div class="bg-gradient-to-r ${isAtrasado ? "from-red-500 to-red-700" : "from-litte-dark to-slate-800"} text-white px-6 py-5 flex items-center justify-between"><div><h3 class="text-xl font-bold capitalize flex items-center gap-2"><i data-lucide="calendar" class="w-5 h-5"></i>${mes}</h3><p class="text-sm text-slate-200 mt-1">${dados.campanhas.length} campanha${dados.campanhas.length > 1 ? "s" : ""}</p></div><div class="text-right"><p class="text-xs text-slate-300 mb-1">Total do M√™s</p><p class="text-3xl font-black">${formatCurrency(dados.total)}</p></div></div><div class="p-4"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b-2 border-slate-200"><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">ID</th><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">Influenciador</th><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">Marca</th><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">Valor</th><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">Data Prev. Pgto</th><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">Status Pgto</th><th class="text-left px-4 py-3 text-xs font-bold text-slate-700 uppercase">Status NF</th><th class="text-center px-4 py-3 text-xs font-bold text-slate-700 uppercase">A√ß√µes</th></tr></thead><tbody>`;
                         dados.campanhas.forEach(function (f) {
                              html += `<tr class="border-b border-slate-100 hover:bg-slate-50 transition-all"><td class="px-4 py-4"><span class="font-mono font-bold text-xs text-litte-dark">${f.idCampanha}</span></td><td class="px-4 py-4"><span class="font-semibold text-slate-900 text-sm">${f.nomeInfluenciador || "--"}</span></td><td class="px-4 py-4"><span class="text-slate-700 text-sm">${f.marca || "--"}</span></td><td class="px-4 py-4"><span class="font-bold text-green-700 text-lg">${formatCurrency(f.valorTotal || 0)}</span></td><td class="px-4 py-4"><span class="text-sm text-slate-600">${f.dataPrevistaPagamento ? formatDate(f.dataPrevistaPagamento) : "--"}</span></td><td class="px-4 py-4"><span class="badge ${getStatusPagamentoBadge(f.statusPagamento).class} text-xs">${f.statusPagamento || "--"}</span></td><td class="px-4 py-4"><span class="badge ${getStatusNFBadge(f.statusNF).class} text-xs">${f.statusNF || "--"}</span></td><td class="px-4 py-4"><div class="flex items-center justify-center gap-1"><button onclick="verDetalhesFinanceiro('${f.idCampanha}')" class="p-2 hover:bg-blue-50 rounded-xl transition-all" title="Ver detalhes"><i data-lucide="eye" class="w-4 h-4 text-slate-600"></i></button><button onclick="openModalChecklist('${f.idCampanha}')" class="p-2 hover:bg-green-50 rounded-xl transition-all" title="Abrir Checklist"><i data-lucide="check-square" class="w-4 h-4 text-slate-600"></i></button></div></td></tr>`;
                         });
                         html += `</tbody></table></div></div></div>`;
                    });
                    document.getElementById("financeiro-por-mes-container").innerHTML = html;
                    lucide.createIcons();
               }
               function getStatusPagamentoBadge(status) {
                    const badges = {
                         PENDENTE: { class: "bg-yellow-100 text-yellow-800" },
                         PAGO: { class: "bg-green-100 text-green-800" },
                         ATRASADO: { class: "bg-red-100 text-red-800" },
                         CANCELADO: { class: "bg-slate-100 text-slate-800" },
                    };
                    return badges[status] || { class: "bg-slate-100 text-slate-800" };
               }
               function getStatusNFBadge(status) {
                    const badges = {
                         "A EMITIR": { class: "bg-orange-100 text-orange-800" },
                         EMITIDA: { class: "bg-blue-100 text-blue-800" },
                         ENVIADA: { class: "bg-purple-100 text-purple-800" },
                         RECEBIDA: { class: "bg-green-100 text-green-800" },
                         CORRIGIR: { class: "bg-red-100 text-red-800" },
                    };
                    return badges[status] || { class: "bg-slate-100 text-slate-800" };
               }
               function verDetalhesFinanceiro(idCampanha) {
                    openModalFinanceiroCampanha(idCampanha);
               }
               function refreshFinanceiro() {
                    renderFinanceiro();
               }
               function renderTemplates() {
                    document.getElementById("view-title").textContent = "Templates";
                    document.getElementById("view-subtitle").textContent = "Mensagens e modelos reutiliz√°veis";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="openModalNovoTemplate()" class="btn-primary px-4 py-2 rounded-xl flex items-center gap-2 font-medium shadow-lg"><i data-lucide="plus" class="w-4 h-4"></i><span>Novo Template</span></button><button onclick="refreshTemplates()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    showLoading("Carregando templates...");
                    google.script.run
                         .withSuccessHandler(function (templates) {
                              hideLoading();
                              cachedData.templates = templates;
                              renderListaTemplates(templates);
                              updateLastSync();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar templates", "error");
                              console.error(error);
                         })
                         .getAllTemplates();
               }
               function renderListaTemplates(templates) {
                    if (!templates || templates.length === 0) {
                         document.getElementById("view-content").innerHTML =
                              `<div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-12 text-center"><i data-lucide="file-text" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i><p class="text-lg font-semibold text-slate-600 mb-4">Nenhum template cadastrado</p><button onclick="openModalNovoTemplate()" class="btn-primary px-6 py-3 rounded-xl">Criar Primeiro Template</button></div>`;
                         lucide.createIcons();
                         return;
                    }
                    let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';
                    templates.forEach(function (t) {
                         const previewCorpo = (t.corpo || "").substring(0, 150) + (t.corpo.length > 150 ? "..." : "");
                         html += `<div class="bg-white rounded-2xl border-2 border-slate-200 hover:border-litte-green hover:shadow-xl transition-all p-6"><div class="flex items-start justify-between mb-4"><h3 class="text-lg font-bold text-slate-900 flex-1">${t.titulo || "Sem t√≠tulo"}</h3><div class="flex gap-1"><button onclick="copiarTemplate('${t.id}')" class="p-2 hover:bg-green-50 rounded-xl transition-all" title="Copiar"><i data-lucide="copy" class="w-4 h-4 text-slate-600"></i></button><button onclick="editarTemplate('${t.id}')" class="p-2 hover:bg-blue-50 rounded-xl transition-all" title="Editar"><i data-lucide="edit" class="w-4 h-4 text-slate-600"></i></button></div></div><div class="bg-slate-50 rounded-xl p-4 mb-4"><p class="text-sm text-slate-700 whitespace-pre-wrap">${previewCorpo}</p></div><div class="flex items-center gap-2 text-xs text-slate-500"><i data-lucide="calendar" class="w-3 h-3"></i><span>${formatDate(t.dataCriacao)}</span></div></div>`;
                    });
                    html += "</div>";
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function openModalNovoTemplate() {
                    const modalHTML = `<div id="modal-novo-template" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="plus-circle" class="w-5 h-5"></i>Novo Template</h3><p class="text-sm text-slate-300 mt-1">Criar modelo de mensagem reutiliz√°vel</p></div><button onclick="closeModal('modal-novo-template')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-novo-template" onsubmit="salvarNovoTemplate(event)"><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">T√≠tulo do Template *</label><input type="text" name="titulo" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Ex: Email de Follow-up"></div><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">Corpo do Template *</label><textarea name="corpo" required rows="12" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green font-mono text-sm" placeholder="Digite o conte√∫do do template aqui..."></textarea><p class="text-xs text-slate-500 mt-2 italic">üí° Dica: Use vari√°veis como [NOME], [MARCA], [VALOR] que podem ser substitu√≠das depois</p></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-novo-template')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold transition-all">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2"><i data-lucide="save" class="w-4 h-4"></i>Salvar Template</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function salvarNovoTemplate(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const dados = { titulo: formData.get("titulo"), corpo: formData.get("corpo") };
                    showLoading("Salvando template...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-novo-template");
                                   showToast("‚úÖ Template criado!", "success");
                                   cachedData.templates = null;
                                   setTimeout(function () {
                                        renderTemplates();
                                   }, 500);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar template", "error");
                              console.error(error);
                         })
                         .criarTemplate(dados);
               }
               function copiarTemplate(id) {
                    const template = cachedData.templates.find((t) => t.id === id);
                    if (!template) return;
                    navigator.clipboard
                         .writeText(template.corpo)
                         .then(function () {
                              showToast("‚úÖ Template copiado para √°rea de transfer√™ncia!", "success");
                         })
                         .catch(function () {
                              showToast("‚ùå Erro ao copiar", "error");
                         });
               }
               function editarTemplate(id) {
                    const template = cachedData.templates.find((t) => t.id === id);
                    if (!template) {
                         showToast("‚ùå Template n√£o encontrado", "error");
                         return;
                    }
                    const modalHTML = `<div id="modal-editar-template" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="edit" class="w-5 h-5"></i>Editar Template</h3><p class="text-sm text-slate-300 mt-1">ID: ${template.id}</p></div><button onclick="closeModal('modal-editar-template')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-editar-template" onsubmit="salvarEdicaoTemplate(event)"><input type="hidden" name="id" value="${template.id}"><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">T√≠tulo do Template *</label><input type="text" name="titulo" value="${template.titulo}" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"></div><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">Corpo do Template *</label><textarea name="corpo" required rows="12" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green font-mono text-sm">${template.corpo}</textarea></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-editar-template')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg"><i data-lucide="save" class="w-4 h-4 inline"></i> Salvar Altera√ß√µes</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function salvarEdicaoTemplate(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const dados = {
                         id: formData.get("id"),
                         titulo: formData.get("titulo"),
                         corpo: formData.get("corpo"),
                    };
                    showLoading("Salvando...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-editar-template");
                                   showToast("‚úÖ Template atualizado!", "success");
                                   cachedData.templates = null;
                                   setTimeout(function () {
                                        renderTemplates();
                                   }, 500);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar", "error");
                              console.error(error);
                         })
                         .atualizarTemplate(dados);
               }
               function refreshTemplates() {
                    renderTemplates();
               }
               function renderNotas() {
                    document.getElementById("view-title").textContent = "Notas";
                    document.getElementById("view-subtitle").textContent = "Anota√ß√µes e lembretes";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="openModalNovaNota()" class="btn-primary px-4 py-2 rounded-xl flex items-center gap-2 font-medium shadow-lg"><i data-lucide="plus" class="w-4 h-4"></i><span>Nova Nota</span></button><button onclick="refreshNotas()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    showLoading("Carregando notas...");
                    google.script.run
                         .withSuccessHandler(function (notas) {
                              hideLoading();
                              cachedData.notas = notas;
                              renderListaNotas(notas);
                              updateLastSync();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar notas", "error");
                              console.error(error);
                         })
                         .getAllNotas();
               }
               function renderListaNotas(notas) {
                    if (!notas || notas.length === 0) {
                         document.getElementById("view-content").innerHTML =
                              `<div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-12 text-center"><i data-lucide="sticky-note" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i><p class="text-lg font-semibold text-slate-600 mb-4">Nenhuma nota criada</p><button onclick="openModalNovaNota()" class="btn-primary px-6 py-3 rounded-xl">Criar Primeira Nota</button></div>`;
                         lucide.createIcons();
                         return;
                    }
                    let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';
                    notas.forEach(function (n) {
                         const cores = {
                              Geral: "border-blue-300 bg-blue-50",
                              Campanha: "border-green-300 bg-green-50",
                              Assessorado: "border-purple-300 bg-purple-50",
                         };
                         const corClass = cores[n.tipo] || "border-slate-300 bg-slate-50";
                         html += `<div class="rounded-2xl border-2 ${corClass} hover:shadow-xl transition-all p-6"><div class="flex items-start justify-between mb-3"><div class="flex-1"><h3 class="text-lg font-bold text-slate-900 mb-1">${n.titulo || "Sem t√≠tulo"}</h3><span class="badge badge-info text-xs">${n.tipo || "Geral"}</span></div><div class="flex gap-1"><button onclick="editarNota('${n.id}')" class="p-1 hover:bg-white rounded-lg transition-all" title="Editar"><i data-lucide="edit" class="w-4 h-4 text-slate-600"></i></button><button onclick="excluirNota('${n.id}')" class="p-1 hover:bg-red-100 rounded-lg transition-all" title="Excluir"><i data-lucide="trash-2" class="w-4 h-4 text-red-600"></i></button></div></div><div class="bg-white rounded-xl p-4 mb-3"><p class="text-sm text-slate-700 whitespace-pre-wrap">${n.conteudo || ""}</p></div>${n.idRelacionado ? `<p class="text-xs text-slate-600 mb-2"><span class="font-semibold">Relacionado:</span> ${n.idRelacionado}</p>` : ""}<div class="flex items-center gap-2 text-xs text-slate-500"><i data-lucide="calendar" class="w-3 h-3"></i><span>${formatDate(n.dataCriacao)}</span></div></div>`;
                    });
                    html += "</div>";
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function openModalNovaNota() {
                    const modalHTML = `<div id="modal-nova-nota" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="plus-circle" class="w-5 h-5"></i>Nova Nota</h3><p class="text-sm text-slate-300 mt-1">Criar anota√ß√£o ou lembrete</p></div><button onclick="closeModal('modal-nova-nota')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-nova-nota" onsubmit="salvarNovaNota(event)"><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">T√≠tulo *</label><input type="text" name="titulo" required class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="T√≠tulo da nota"></div><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">Tipo *</label><select name="tipo" required onchange="toggleIdRelacionado()" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green"><option value="Geral">Geral</option><option value="Campanha">Campanha</option><option value="Assessorado">Assessorado</option></select></div><div id="campo-id-relacionado" class="mb-4 hidden"><label class="block text-sm font-semibold text-slate-700 mb-2">ID Relacionado</label><input type="text" name="idRelacionado" class="w-full px-4 py-3 border border-slate-300 rounded-xl" placeholder="Ex: CAM001, ASS001"></div><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">Conte√∫do *</label><textarea name="conteudo" required rows="8" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-litte-green" placeholder="Escreva sua nota aqui..."></textarea></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-nova-nota')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg"><i data-lucide="save" class="w-4 h-4 inline"></i> Salvar Nota</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function toggleIdRelacionado() {
                    const tipo = document.querySelector('[name="tipo"]').value;
                    const campo = document.getElementById("campo-id-relacionado");
                    if (tipo === "Campanha" || tipo === "Assessorado") {
                         campo.classList.remove("hidden");
                    } else {
                         campo.classList.add("hidden");
                    }
               }
               function salvarNovaNota(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const dados = {
                         titulo: formData.get("titulo"),
                         tipo: formData.get("tipo"),
                         conteudo: formData.get("conteudo"),
                         idRelacionado: formData.get("idRelacionado") || "",
                    };
                    showLoading("Salvando nota...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-nova-nota");
                                   showToast("‚úÖ Nota criada!", "success");
                                   cachedData.notas = null;
                                   setTimeout(function () {
                                        renderNotas();
                                   }, 500);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar nota", "error");
                              console.error(error);
                         })
                         .criarNota(dados);
               }
               function editarNota(id) {
                    const nota = cachedData.notas.find((n) => n.id === id);
                    if (!nota) {
                         showToast("‚ùå Nota n√£o encontrada", "error");
                         return;
                    }
                    const modalHTML = `<div id="modal-editar-nota" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 fade-in"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4 modal-enter"><div class="sticky top-0 z-10 bg-gradient-to-r from-litte-dark to-slate-800 text-white px-6 py-5 flex items-center justify-between rounded-t-3xl"><div><h3 class="text-xl font-bold flex items-center gap-2"><i data-lucide="edit" class="w-5 h-5"></i>Editar Nota</h3><p class="text-sm text-slate-300 mt-1">ID: ${nota.id}</p></div><button onclick="closeModal('modal-editar-nota')" class="text-2xl hover:text-slate-300 transition-all hover:rotate-90">&times;</button></div><div class="p-6"><form id="form-editar-nota" onsubmit="salvarEdicaoNota(event)"><input type="hidden" name="id" value="${nota.id}"><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">T√≠tulo *</label><input type="text" name="titulo" value="${nota.titulo}" required class="w-full px-4 py-3 border border-slate-300 rounded-xl"></div><div class="mb-4"><label class="block text-sm font-semibold text-slate-700 mb-2">Conte√∫do *</label><textarea name="conteudo" required rows="8" class="w-full px-4 py-3 border border-slate-300 rounded-xl">${nota.conteudo}</textarea></div><div class="flex gap-3 justify-end pt-4 border-t-2 border-slate-200"><button type="button" onclick="closeModal('modal-editar-nota')" class="px-6 py-3 border-2 border-slate-300 rounded-xl hover:bg-slate-50 font-semibold">Cancelar</button><button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold shadow-lg"><i data-lucide="save" class="w-4 h-4 inline"></i> Salvar</button></div></form></div></div></div>`;
                    document.getElementById("modals-container").innerHTML = modalHTML;
                    lucide.createIcons();
               }
               function salvarEdicaoNota(event) {
                    event.preventDefault();
                    const form = event.target;
                    const formData = new FormData(form);
                    const dados = {
                         id: formData.get("id"),
                         titulo: formData.get("titulo"),
                         conteudo: formData.get("conteudo"),
                    };
                    showLoading("Salvando...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   closeModal("modal-editar-nota");
                                   showToast("‚úÖ Nota atualizada!", "success");
                                   cachedData.notas = null;
                                   setTimeout(function () {
                                        renderNotas();
                                   }, 500);
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao salvar", "error");
                              console.error(error);
                         })
                         .atualizarNota(dados);
               }
               function excluirNota(id) {
                    if (!confirm("Tem certeza que deseja excluir esta nota?")) return;
                    showLoading("Excluindo...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Nota exclu√≠da!", "success");
                                   cachedData.notas = null;
                                   renderNotas();
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao excluir", "error");
                              console.error(error);
                         })
                         .excluirNota(id);
               }
               function refreshNotas() {
                    renderNotas();
               }
               function renderNotificacoes() {
                    document.getElementById("view-title").textContent = "Notifica√ß√µes";
                    document.getElementById("view-subtitle").textContent = "Central de notifica√ß√µes do sistema";
                    document.getElementById("view-actions").innerHTML =
                         `<button onclick="marcarTodasLidas()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="check-check" class="w-4 h-4"></i><span>Marcar Todas como Lidas</span></button><button onclick="refreshNotificacoes()" class="btn-secondary px-4 py-2 rounded-xl flex items-center gap-2 font-medium"><i data-lucide="refresh-cw" class="w-4 h-4"></i><span>Atualizar</span></button>`;
                    lucide.createIcons();
                    showLoading("Carregando notifica√ß√µes...");
                    google.script.run
                         .withSuccessHandler(function (notificacoes) {
                              hideLoading();
                              cachedData.notificacoes = notificacoes;
                              renderListaNotificacoes(notificacoes);
                              updateLastSync();
                              atualizarBadgeNotificacoes();
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("Erro ao carregar notifica√ß√µes", "error");
                              console.error(error);
                         })
                         .getNotificacoes("TODOS", false);
               }
               function renderListaNotificacoes(notificacoes) {
                    if (!notificacoes || notificacoes.length === 0) {
                         document.getElementById("view-content").innerHTML =
                              `<div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-12 text-center"><i data-lucide="bell-off" class="w-16 h-16 text-slate-300 mx-auto mb-4"></i><p class="text-lg font-semibold text-slate-600">Nenhuma notifica√ß√£o</p><p class="text-sm text-slate-500 mt-2">Voc√™ est√° em dia! üéâ</p></div>`;
                         lucide.createIcons();
                         return;
                    }
                    let html = '<div class="space-y-3">';
                    notificacoes.forEach(function (n) {
                         const prioridadeClass = getPrioridadeClass(n.prioridade);
                         const tipoIcon = getTipoIcon(n.tipo);
                         html += `<div class="bg-white rounded-2xl border-2 ${n.lida ? "border-slate-200" : "border-litte-green"} hover:shadow-lg transition-all p-5 ${n.lida ? "opacity-60" : ""}"><div class="flex items-start gap-4"><div class="w-12 h-12 ${prioridadeClass} rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm"><i data-lucide="${tipoIcon}" class="w-6 h-6 text-white"></i></div><div class="flex-1 min-w-0"><div class="flex items-start justify-between mb-2"><div class="flex-1"><h4 class="font-bold text-slate-900 mb-1">${n.titulo}</h4><p class="text-sm text-slate-700">${n.mensagem}</p></div>${!n.lida ? `<button onclick="marcarComoLida('${n.id}')" class="ml-3 p-2 hover:bg-green-50 rounded-xl transition-all" title="Marcar como lida"><i data-lucide="check" class="w-4 h-4 text-green-600"></i></button>` : ""}</div><div class="flex items-center gap-3 mt-2"><span class="badge ${prioridadeClass.replace("bg-", "bg-").replace("500", "100").replace("600", "800")} text-xs">${n.prioridade}</span><span class="badge badge-info text-xs">${n.tipo}</span>${n.idCampanha ? `<span class="text-xs text-slate-500 font-mono">${n.idCampanha}</span>` : ""}<span class="text-xs text-slate-400">${formatDateTime(n.dataHora)}</span></div></div></div></div>`;
                    });
                    html += "</div>";
                    document.getElementById("view-content").innerHTML = html;
                    lucide.createIcons();
               }
               function getPrioridadeClass(prioridade) {
                    const classes = {
                         BAIXA: "bg-slate-500",
                         M√âDIA: "bg-blue-500",
                         ALTA: "bg-orange-500",
                         CR√çTICA: "bg-red-600",
                    };
                    return classes[prioridade] || "bg-slate-500";
               }
               function getTipoIcon(tipo) {
                    const icons = {
                         SISTEMA: "settings",
                         PRAZO: "clock",
                         STATUS: "bar-chart",
                         PAGAMENTO: "dollar-sign",
                         COMENTARIO: "message-circle",
                         APROVACAO: "check-circle",
                         ALERTA: "alert-triangle",
                         ERRO: "x-circle",
                         SUCESSO: "check-circle",
                    };
                    return icons[tipo] || "bell";
               }
               function marcarComoLida(id) {
                    google.script.run
                         .withSuccessHandler(function (result) {
                              if (result.success) {
                                   showToast("‚úÖ Marcada como lida", "success");
                                   refreshNotificacoes();
                              } else {
                                   showToast("‚ùå Erro", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              showToast("‚ùå Erro", "error");
                         })
                         .marcarNotificacaoLida(id);
               }
               function marcarTodasLidas() {
                    google.script.run
                         .withSuccessHandler(function (result) {
                              if (result.success) {
                                   showToast("‚úÖ Todas marcadas como lidas!", "success");
                                   refreshNotificacoes();
                              } else {
                                   showToast("‚ùå Erro", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              showToast("‚ùå Erro", "error");
                         })
                         .marcarTodasNotificacoesLidas("TODOS");
               }
               function atualizarBadgeNotificacoes() {
                    google.script.run
                         .withSuccessHandler(function (count) {
                              const badge = document.getElementById("notif-badge");
                              if (count > 0) {
                                   badge.textContent = count > 99 ? "99+" : count;
                                   badge.classList.remove("hidden");
                              } else {
                                   badge.classList.add("hidden");
                              }
                         })
                         .withFailureHandler(function (error) {
                              console.error("Erro ao atualizar badge de notifica√ß√µes:", error);
                         })
                         .contarNotificacoesNaoLidas("TODOS");
               }
               function refreshNotificacoes() {
                    renderNotificacoes();
               }
               function renderConfig() {
                    document.getElementById("view-title").textContent = "Configura√ß√µes";
                    document.getElementById("view-subtitle").textContent = "Configura√ß√µes e manuten√ß√£o do sistema";
                    document.getElementById("view-actions").innerHTML = "";
                    document.getElementById("view-content").innerHTML =
                         `<div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6"><h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="link" class="w-5 h-5"></i>Integra√ß√µes</h3><div class="space-y-4"><div class="bg-green-50 border-2 border-green-200 rounded-2xl p-5 flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center"><i data-lucide="hard-drive" class="w-6 h-6 text-white"></i></div><div><p class="font-bold text-slate-900">Google Drive</p><p class="text-sm text-slate-600">Armazenamento de arquivos</p></div></div><span class="badge badge-success">Conectado</span></div><div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-5 flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center"><i data-lucide="calendar" class="w-6 h-6 text-white"></i></div><div><p class="font-bold text-slate-900">Google Calendar</p><p class="text-sm text-slate-600">Agendamento de eventos</p></div></div><span class="badge badge-success">Conectado</span></div><div class="bg-purple-50 border-2 border-purple-200 rounded-2xl p-5 flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center"><i data-lucide="table" class="w-6 h-6 text-white"></i></div><div><p class="font-bold text-slate-900">Google Sheets</p><p class="text-sm text-slate-600">Banco de dados</p></div></div><span class="badge badge-success">Conectado</span></div></div></div><div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6"><h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="info" class="w-5 h-5"></i>Informa√ß√µes do Sistema</h3><div class="space-y-3"><div class="flex justify-between items-center py-3 border-b border-slate-100"><span class="text-slate-600 font-semibold">Vers√£o:</span><span class="font-bold text-slate-900">3.5 Premium</span></div><div class="flex justify-between items-center py-3 border-b border-slate-100"><span class="text-slate-600 font-semibold">Ambiente:</span><span class="badge badge-success">Produ√ß√£o</span></div><div class="flex justify-between items-center py-3 border-b border-slate-100"><span class="text-slate-600 font-semibold">√öltima Sincroniza√ß√£o:</span><span class="text-slate-900" id="ultima-sync-config">--</span></div><div class="flex justify-between items-center py-3"><span class="text-slate-600 font-semibold">Status:</span><span class="badge badge-success">Operacional</span></div></div></div><div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6"><h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5"></i>A√ß√µes do Sistema</h3><div class="grid grid-cols-1 gap-3"><button onclick="sincronizarTudo()" class="w-full bg-gradient-to-r from-litte-green to-emerald-600 text-white px-6 py-4 rounded-xl font-semibold hover:shadow-xl transition-all flex items-center justify-center gap-2"><i data-lucide="refresh-cw" class="w-5 h-5"></i>Sincronizar Tudo</button><button onclick="setupCompleto()" class="w-full bg-gradient-to-r from-blue-500 to-blue-700 text-white px-6 py-4 rounded-xl font-semibold hover:shadow-xl transition-all flex items-center justify-center gap-2"><i data-lucide="play-circle" class="w-5 h-5"></i>Setup Completo</button><button onclick="verificarPrazos()" class="w-full bg-gradient-to-r from-orange-500 to-orange-700 text-white px-6 py-4 rounded-xl font-semibold hover:shadow-xl transition-all flex items-center justify-center gap-2"><i data-lucide="clock" class="w-5 h-5"></i>Verificar Prazos Vencidos</button><button onclick="testarIntegracoes()" class="w-full bg-gradient-to-r from-purple-500 to-purple-700 text-white px-6 py-4 rounded-xl font-semibold hover:shadow-xl transition-all flex items-center justify-center gap-2"><i data-lucide="check-circle" class="w-5 h-5"></i>Testar Integra√ß√µes</button></div></div><div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6"><h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="bar-chart-2" class="w-5 h-5"></i>Estat√≠sticas do Sistema</h3><div id="estatisticas-container" class="space-y-3"><div class="flex items-center justify-center py-8"><div class="spinner"></div></div></div></div></div>`;
                    lucide.createIcons();
                    carregarEstatisticas();
                    document.getElementById("ultima-sync-config").textContent =
                         document.getElementById("last-sync").textContent;
               }
               function carregarEstatisticas() {
                    google.script.run
                         .withSuccessHandler(function (data) {
                              const html = `<div class="grid grid-cols-2 gap-3"><div class="bg-blue-50 rounded-xl p-4 text-center"><p class="text-3xl font-black text-blue-700">${data.totalAssessorados || 0}</p><p class="text-xs text-slate-600 font-semibold mt-1">Assessorados</p></div><div class="bg-green-50 rounded-xl p-4 text-center"><p class="text-3xl font-black text-green-700">${data.campanhasAtivas || 0}</p><p class="text-xs text-slate-600 font-semibold mt-1">Campanhas Ativas</p></div><div class="bg-purple-50 rounded-xl p-4 text-center"><p class="text-3xl font-black text-purple-700">${data.prospeccoes || 0}</p><p class="text-xs text-slate-600 font-semibold mt-1">Prospec√ß√µes</p></div><div class="bg-orange-50 rounded-xl p-4 text-center"><p class="text-3xl font-black text-orange-700">${data.pendencias || 0}</p><p class="text-xs text-slate-600 font-semibold mt-1">Pend√™ncias</p></div></div>`;
                              document.getElementById("estatisticas-container").innerHTML = html;
                         })
                         .withFailureHandler(function () {
                              document.getElementById("estatisticas-container").innerHTML =
                                   `<p class="text-center text-red-500 text-sm">Erro ao carregar estat√≠sticas</p>`;
                         })
                         .getDashboardData();
               }
               function sincronizarTudo() {
                    showLoading("Sincronizando todos os sistemas...");
                    let completed = 0;
                    const total = 3;
                    function checkComplete() {
                         completed++;
                         if (completed === total) {
                              hideLoading();
                              showToast("‚úÖ Sincroniza√ß√£o completa!", "success");
                              updateLastSync();
                         }
                    }
                    google.script.run
                         .withSuccessHandler(checkComplete)
                         .withFailureHandler(function () {
                              checkComplete();
                              showToast("‚ö†Ô∏è Erro ao sincronizar campanhas", "error");
                         })
                         .sincronizarCampanhasAtivas();
                    google.script.run
                         .withSuccessHandler(checkComplete)
                         .withFailureHandler(function () {
                              checkComplete();
                              showToast("‚ö†Ô∏è Erro ao sincronizar financeiro master", "error");
                         })
                         .sincronizarFinanceiroMaster();
                    google.script.run
                         .withSuccessHandler(checkComplete)
                         .withFailureHandler(function () {
                              checkComplete();
                              showToast("‚ö†Ô∏è Erro ao sincronizar repasses", "error");
                         })
                         .sincronizarControleRepasses();
               }
               function setupCompleto() {
                    if (!confirm("Esta a√ß√£o ir√° criar todas as abas necess√°rias no sistema. Continuar?")) return;
                    showLoading("Executando setup completo...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Setup executado com sucesso!", "success");
                              } else {
                                   showToast("‚ùå Erro: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao executar setup", "error");
                              console.error(error);
                         })
                         .setupSheets();
               }
               function verificarPrazos() {
                    showLoading("Verificando prazos vencidos...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast(
                                        `‚úÖ Verifica√ß√£o conclu√≠da! ${result.atualizados || 0} campanhas atualizadas`,
                                        "success"
                                   );
                              } else {
                                   showToast("‚ùå Erro na verifica√ß√£o", "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao verificar prazos", "error");
                              console.error(error);
                         })
                         .verificarPrazosVencidos();
               }
               function testarIntegracoes() {
                    showLoading("Testando integra√ß√µes...");
                    google.script.run
                         .withSuccessHandler(function (result) {
                              hideLoading();
                              if (result.success) {
                                   showToast("‚úÖ Todas as integra√ß√µes funcionando!", "success");
                              } else {
                                   showToast("‚ùå Falhas detectadas: " + result.message, "error");
                              }
                         })
                         .withFailureHandler(function (error) {
                              hideLoading();
                              showToast("‚ùå Erro ao testar integra√ß√µes", "error");
                              console.error(error);
                         })
                         .testarIntegracoes();
               }
               document.addEventListener("DOMContentLoaded", function () {
                    lucide.createIcons();
                    renderDashboard();
                    setInterval(function () {
                         atualizarBadgeNotificacoes();
                    }, 30000);
                    console.log(
                         "%cüéâ Sistema Litt√™ v3.5 Premium Carregado!",
                         "color:#10B981;font-size:16px;font-weight:bold"
                    );
                    console.log(
                         "%cüíö Desenvolvido com ‚ù§Ô∏è para otimizar a gest√£o de influenciadores",
                         "color:#6366F1;font-size:12px"
                    );
               });
          </script>
     </body>
</html>
